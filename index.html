<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic SEO & GEO Architect v3.2 (DeepSeek Edition)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .step-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Force remove default select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icons = {
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            Building: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="9" y1="22" x2="9" y2="22.01"></line><line x1="15" y1="22" x2="15" y2="22.01"></line><line x1="12" y1="22" x2="12" y2="22.01"></line><line x1="12" y1="18" x2="12" y2="18.01"></line><line x1="9" y1="18" x2="9" y2="18.01"></line><line x1="15" y1="18" x2="15" y2="18.01"></line><line x1="12" y1="14" x2="12" y2="14.01"></line><line x1="9" y1="14" x2="9" y2="14.01"></line><line x1="15" y1="14" x2="15" y2="14.01"></line><line x1="12" y1="10" x2="12" y2="10.01"></line><line x1="9" y1="10" x2="9" y2="10.01"></line><line x1="15" y1="10" x2="15" y2="10.01"></line><line x1="12" y1="6" x2="12" y2="6.01"></line><line x1="9" y1="6" x2="9" y2="6.01"></line><line x1="15" y1="6" x2="15" y2="6.01"></line></svg>,
            Globe: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Wrench: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
            PenTool: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Code: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-4A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-4A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            ArrowRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
            ChevronDown: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            ExternalLink: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
            MagicWand: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m19 2 2 2-2 2-2-2 2-2Z"/><path d="m5 16 6-6 7 7"/><path d="m12 13 1 1"/><path d="m8 21 2-2 2 2-2 2-2-2Z"/><path d="m1 21 2-2 2 2-2 2-2-2Z"/><path d="m1 5 2-2 2 2-2 2-2-2Z"/></svg>,
            RotateCcw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Loader: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
            Send: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Cpu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Book: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Link: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        };

        const { Copy, Check, FileText, Search, Zap, Cpu, MapPin, Users, Activity, Building, Book, ChevronDown, ArrowRight, Globe, Wrench, PenTool, Code, Brain, Link, Trash, Plus, ExternalLink, MagicWand, RotateCcw, Loader, Send } = Icons;

        // --- CONSTANTS ---
        const CONTINENTS = {
            "North America": ["United States", "Canada", "Mexico", "Antigua and Barbuda", "Bahamas", "Barbados", "Belize", "Costa Rica", "Cuba", "Dominica", "Dominican Republic", "El Salvador", "Grenada", "Guatemala", "Haiti", "Honduras", "Jamaica", "Nicaragua", "Panama", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Trinidad and Tobago"],
            "South America": ["Argentina", "Bolivia", "Brazil", "Chile", "Colombia", "Ecuador", "Guyana", "Paraguay", "Peru", "Suriname", "Uruguay", "Venezuela"],
            "Europe": ["United Kingdom", "Germany", "France", "Italy", "Spain", "Netherlands", "Albania", "Andorra", "Austria", "Belarus", "Belgium", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Cyprus", "Czech Republic", "Denmark", "Estonia", "Finland", "Greece", "Hungary", "Iceland", "Ireland", "Kosovo", "Latvia", "Liechtenstein", "Lithuania", "Luxembourg", "Malta", "Moldova", "Monaco", "Montenegro", "North Macedonia", "Norway", "Poland", "Portugal", "Romania", "Russia", "San Marino", "Serbia", "Slovakia", "Slovenia", "Sweden", "Switzerland", "Ukraine", "Vatican City"],
            "Asia": ["China", "Japan", "India", "South Korea", "Singapore", "Taiwan", "Hong Kong", "Afghanistan", "Armenia", "Azerbaijan", "Bahrain", "Bangladesh", "Bhutan", "Brunei", "Cambodia", "Georgia", "Indonesia", "Iran", "Iraq", "Israel", "Jordan", "Kazakhstan", "Kuwait", "Kyrgyzstan", "Laos", "Lebanon", "Malaysia", "Maldives", "Mongolia", "Myanmar", "Nepal", "North Korea", "Oman", "Pakistan", "Palestine", "Philippines", "Qatar", "Saudi Arabia", "Sri Lanka", "Syria", "Tajikistan", "Thailand", "Timor-Leste", "Turkey", "Turkmenistan", "United Arab Emirates", "Uzbekistan", "Vietnam", "Yemen"],
            "Africa": ["South Africa", "Nigeria", "Egypt", "Kenya", "Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Congo (DRC)", "Congo (Republic)", "Cote d'Ivoire", "Djibouti", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Rwanda", "Sao Tome and Principe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Sudan", "Sudan", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia", "Zimbabwe"],
            "Oceania": ["Australia", "New Zealand", "Fiji", "Kiribati", "Marshall Islands", "Micronesia", "Nauru", "Palau", "Papua New Guinea", "Samoa", "Solomon Islands", "Tonga", "Tuvalu", "Vanuatu"]
        };

        const PRODUCT_CATEGORIES = {
            "Electronics": {
                "Mobile Accessories": ["USB Cable", "Power Bank", "Wall Charger", "Protective Case", "Screen Protector"],
                "Audio & Video": ["Headphones", "Bluetooth Speakers", "Home Theater", "Microphones"],
                "Computers": ["Laptops", "Tablets", "Monitors", "Keyboards", "Mice"],
                "Cameras": ["Digital Cameras", "Lenses", "Drones", "Action Cameras"],
                "Wearable Technology": ["Smartwatches", "Fitness Trackers", "VR Headsets"],
                "Home Appliances": ["Smart Plugs", "Smart Lights", "Security Cameras", "Robot Vacuums"]
            },
            "Home & Garden": {
                "Furniture": ["Living Room", "Bedroom", "Office", "Outdoor"],
                "Kitchen": ["Appliances", "Cookware", "Cutlery"],
                "Garden": ["Planters", "Tools", "Grills"],
                "Bedding & Mattresses": ["Pillows", "Bed Frames", "Mattress Toppers", "Sheets"],
                "Home Decor": ["Wall Art", "Rugs", "Lighting", "Mirrors"]
            },
            "Clothing & Accessories": {
                "Men's": ["T-Shirts", "Jackets", "Pants", "Activewear"],
                "Women's": ["Dresses", "Tops", "Skirts", "Activewear"],
                "Accessories": ["Watches", "Jewelry", "Sunglasses", "Bags"],
                "Footwear": ["Sneakers", "Boots", "Sandals", "Formal Shoes"],
                "Activewear": ["Workout Clothes", "Joggers", "Sports Bras"]
            },
            "Sports & Outdoors": {
                "Fitness": ["Yoga Mats", "Dumbbells", "Resistance Bands", "Treadmills"],
                "Cycling": ["Bikes", "Helmets", "Accessories"],
                "Camping": ["Tents", "Sleeping Bags", "Backpacks"],
                "Outdoor Adventure": ["Hiking Gear", "Climbing Equipment", "Fishing Rods"],
                "Water Sports": ["Kayaks", "Surfboards", "Paddleboards", "Swimwear"]
            },
            "Beauty & Personal Care": {
                "Skincare": ["Moisturizers", "Cleansers", "Serums"],
                "Haircare": ["Shampoo", "Conditioner", "Styling Tools"],
                "Makeup": ["Face", "Eyes", "Lips"],
                "Fragrances": ["Men's Fragrance", "Women's Fragrance", "Perfume Sets"],
                "Tools & Accessories": ["Brushes", "Combs", "Hair Dryers", "Mirrors"]
            },
            "Automotive": {
                "Car Electronics": ["Dash Cams", "Chargers", "Audio Systems"],
                "Interior": ["Floor Mats", "Seat Covers"],
                "Exterior": ["Car Covers", "Lights"],
                "Tools & Equipment": ["Car Maintenance Tools", "Garage Equipment", "Jacks and Lifts"],
                "Maintenance": ["Engine Diagnostics", "Car Care Kits", "Fluids"],
                "Tire & Wheel": ["Tire Inflators", "Chains", "Wheel Covers"]
            },
            "Food & Beverage": {
                "Packaged Food": ["Snacks", "Canned Goods", "Grains"],
                "Beverages": ["Coffee", "Tea", "Energy Drinks"],
                "Health Foods": ["Protein Powders", "Organic Foods", "Meal Replacements"],
                "Specialty Diets": ["Gluten-Free", "Keto", "Vegan", "Organic"]
            },
            "Toys & Games": {
                "Action Figures": ["Superheroes", "Anime", "Collectibles"],
                "Board Games": ["Strategy", "Card Games", "Family Games"],
                "Puzzles": ["Jigsaw", "3D Puzzles", "Sudoku"],
                "Remote Control Toys": ["RC Cars", "RC Helicopters", "RC Boats"],
                "Educational": ["STEM Kits", "Learning Games", "Montessori"],
                "Outdoor Play": ["Sports Toys", "Water Toys", "Sandboxes"]
            },
            "Books": {
                "Fiction": ["Science Fiction", "Romance", "Mystery & Thriller"],
                "Non-Fiction": ["Biographies & Memoirs", "Business & Economics", "Self-Help"],
                "Educational": ["Textbooks", "Study Guides", "Reference Books"],
                "Digital": ["Ebooks", "Audiobooks"],
                "Kids' Books": ["Picture Books", "Early Readers", "Young Adult"]
            },
            "Health & Household": {
                "Health Care": ["Health Monitors", "Thermometers", "Blood Pressure Monitors"],
                "Household Supplies": ["Cleaning Products", "Air Fresheners", "Trash Bags"],
                "Personal Care": ["Oral Care", "Shaving & Grooming", "Deodorants"],
                "Medical Supplies": ["First Aid", "Diabetes Care", "Physical Therapy"],
                "Household Storage": ["Bins", "Organizers", "Shelving"]
            },
            "Office Supplies": {
                "Office Furniture": ["Desks", "Chairs", "Storage"],
                "Paper & Stationery": ["Notebooks", "Printer Paper", "Filing Supplies"],
                "Office Equipment": ["Printers", "Scanners", "Shredders"],
                "Technology": ["Computers", "Monitors", "Projectors"]
            },
            "Pets": {
                "Pet Food": ["Dog Food", "Cat Food"],
                "Pet Toys": ["Chew Toys", "Interactive Toys"],
                "Pet Supplies": ["Beds", "Leashes", "Collars"],
                "Pet Health": ["Supplements", "Grooming", "Flea Treatment"],
                "Pet Furniture": ["Beds", "Cages", "Crates", "Trees"]
            }
        };

        const GENDERS = ["Male", "Female", "Non-binary", "All"];
        
        const PERSONAS = [
            "Corporate Procurement Managers", "Wholesale Distributors", "Retail Store Owners (SME)",
            "Dropshippers & E-commerce Resellers", "Interior Designers & Architects", "Automotive Repair Shops",
            "Hospitality & Hotel Managers", "Educational Institutions / Schools", "Gym & Fitness Center Owners",
            "Medical & Healthcare Facilities", "Office Managers", "Construction Contractors", "Pet Groomers & Vets",
            "Flagship Device Early Adopters", "High-Performance Mobile Gamers", "Professional Digital Nomads",
            "Tech-Savvy Content Creators", "Smart Home Automators", "Homeowners & Renovators", "DIY Enthusiasts",
            "Eco-Conscious Advocates", "Minimalist Organizers", "Parents & Families", "Gardeners & Outdoor Lovers",
            "Fashion Trendsetters", "Luxury Lifestyle Consumers", "Sneakerheads & Collectors", "Skincare Enthusiasts",
            "Beauty Professionals (Makeup Artists)", "Fitness & Wellness Enthusiasts", "Outdoor Adventurers (Camping/Hiking)",
            "Auto Enthusiasts & Tuners", "Pet Parents", "Bookworms & Students", "Gamers & Streamers",
            "Culinary Enthusiasts / Foodies", "Budget-Conscious Shoppers", "Gift Shoppers", "Senior Citizens"
        ];
        
        const INCOME_GROUPS = ["Low Income", "Middle Income", "High Income", "Affluent"];
        const LANGUAGES = ["Arabic", "Chinese (Mandarin)", "English", "French", "Russian", "Spanish"];

        // --- COMPONENTS ---

        const LoadingSpinner = () => (
            <div className="inline-flex items-center gap-2 text-gray-600 text-sm">
                <Icons.Loader className="animate-spin text-blue-600" size={16} />
                <span>Processing...</span>
            </div>
        );

        const InputField = ({ label, name, value, onChange, placeholder, type = "text", required, icon: Icon, error, action, ...props }) => (
            <div className="mb-4">
                <div className="flex justify-between items-center mb-1">
                    <label className={`block text-xs font-bold uppercase tracking-wider ${error ? 'text-red-500' : 'text-gray-500'}`}>
                        {label} {required && <span className="text-red-500">*</span>}
                    </label>
                    {action && action}
                </div>
                <div className="relative">
                    <input type={type} name={name} value={value || ''} onChange={onChange} placeholder={placeholder} id={name} className={`w-full pl-9 pr-3 py-2.5 border rounded-lg text-sm focus:ring-2 outline-none transition-all ${error ? 'border-red-300 focus:ring-red-200 focus:border-red-500' : 'border-gray-300 focus:ring-blue-500 focus:border-transparent hover:border-blue-300'} ${props.disabled || props.readOnly ? 'bg-gray-100 text-gray-500' : ''}`} {...props} />
                    {Icon ? <Icon className="absolute left-3 top-3 text-gray-400 w-4 h-4" /> : <div className="absolute left-3 top-2.5 w-4 h-4" />}
                </div>
                {error && <p className="text-xs text-red-500 mt-1 animate-fadeIn flex items-center gap-1"><span className="font-bold">!</span> {error}</p>}
            </div>
        );

        const TextArea = ({ label, name, value, onChange, placeholder, error, action }) => (
            <div className="mb-4 col-span-2">
                <div className="flex justify-between items-center mb-1">
                    <label className={`block text-xs font-bold uppercase tracking-wider ${error ? 'text-red-500' : 'text-gray-500'}`}>{label}</label>
                    {action && action}
                </div>
                <textarea name={name} value={value || ''} onChange={onChange} placeholder={placeholder} rows="4" className={`w-full p-3 border rounded-lg text-sm focus:ring-2 outline-none transition-all ${error ? 'border-red-300 focus:ring-red-200 focus:border-red-500' : 'border-gray-300 focus:ring-blue-500 focus:border-transparent hover:border-blue-300'}`}></textarea>
                {error && <p className="text-xs text-red-500 mt-1 animate-fadeIn flex items-center gap-1"><span className="font-bold">!</span> {error}</p>}
            </div>
        );

        const CheckboxGroup = ({ label, options, selected, onChange }) => (
            <div className="mb-4">
                <label className="block text-xs font-bold text-gray-500 uppercase mb-2 tracking-wider">{label}</label>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-2 bg-white border border-gray-200 p-3 rounded-lg max-h-40 overflow-y-auto">
                    {options.map(opt => (
                        <label key={opt} className="flex items-center gap-2 text-sm text-gray-700 cursor-pointer hover:bg-gray-50 p-1 rounded">
                            <input type="checkbox" checked={selected && selected.includes(opt)} onChange={() => onChange(opt)} className="rounded text-blue-600 focus:ring-blue-500" />
                            {opt}
                        </label>
                    ))}
                </div>
            </div>
        );

        const MultiSelectDropdown = ({ label, options, selected, onChange, error }) => {
            const [isOpen, setIsOpen] = useState(false);
            const dropdownRef = useRef(null);
            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) setIsOpen(false);
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);
            return (
                <div className="mb-4 relative" ref={dropdownRef}>
                    <label className={`block text-xs font-bold uppercase mb-1 tracking-wider ${error ? 'text-red-500' : 'text-gray-500'}`}>{label}</label>
                    <button onClick={() => setIsOpen(!isOpen)} className={`w-full text-left bg-white border py-2.5 px-3 rounded-lg text-sm focus:outline-none focus:ring-2 flex justify-between items-center transition-colors ${error ? 'border-red-300 focus:ring-red-200' : 'border-gray-300 focus:ring-blue-500 hover:border-blue-300'} text-gray-700`}>
                        <span className="truncate">{selected && selected.length > 0 ? `${selected.length} Selected` : "Select Options..."}</span>
                        <ChevronDown size={16} className={`text-gray-400 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`} />
                    </button>
                    {isOpen && (
                        <div className="absolute z-20 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                            {options.map(opt => (
                                <label key={opt} className="flex items-center gap-2 text-sm text-gray-700 cursor-pointer hover:bg-blue-50 p-2.5 border-b border-gray-100 last:border-0 transition-colors">
                                    <input type="checkbox" checked={selected ? selected.includes(opt) : false} onChange={() => onChange(opt)} className="rounded text-blue-600 focus:ring-blue-500 w-4 h-4" />
                                    {opt}
                                </label>
                            ))}
                        </div>
                    )}
                    {error && <p className="text-xs text-red-500 mt-1 animate-fadeIn flex items-center gap-1"><span className="font-bold">!</span> {error}</p>}
                    {selected && selected.length > 0 && (
                        <div className="flex flex-wrap gap-2 mt-2">
                            {selected.map(item => (
                                <span key={item} className="inline-flex items-center gap-1 bg-blue-50 border border-blue-100 text-blue-700 text-xs font-medium px-2.5 py-1 rounded-full animate-fadeIn">
                                    {item}
                                    <button onClick={() => onChange(item)} className="hover:text-blue-900 focus:outline-none ml-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                    </button>
                                </span>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const CopyButton = ({ text }) => {
            const [copied, setCopied] = useState(false);
            const handleCopy = () => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try { document.execCommand('copy'); setCopied(true); setTimeout(() => setCopied(false), 2000); } catch (err) { console.error('Fallback: Oops, unable to copy', err); }
                document.body.removeChild(textArea);
            };
            return (
                <button aria-label="Copy to clipboard" onClick={handleCopy} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium transition-colors border ${copied ? 'bg-green-50 border-green-200 text-green-700' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                    {copied ? <Check size={14} /> : <Copy size={14} />} {copied ? 'Copied' : 'Copy'}
                </button>
            );
        };

        const SidebarStep = ({ stepNumber, label, icon: Icon, current, onClick }) => (
            <button onClick={() => onClick(stepNumber)} className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-lg cursor-pointer transition-all border-l-4 text-left ${current === stepNumber ? 'bg-blue-900 border-blue-500 text-white shadow-lg' : 'border-transparent text-gray-400 hover:text-white hover:bg-gray-800'}`}>
                <div className={`flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${current === stepNumber ? 'bg-blue-500 text-white' : 'bg-gray-700 text-gray-400'}`}>{stepNumber}</div>
                <span className="font-medium text-xs md:text-sm">{label}</span>
            </button>
        );
        
        const ProgressBar = ({ step }) => (
            <div className="w-full bg-gray-200 h-1.5 mb-0">
                <div className="bg-blue-600 h-1.5 transition-all duration-500 ease-out" style={{ width: `${(step / 6) * 100}%` }}></div>
            </div>
        );

        // --- APP COMPONENT ---

        const App = () => {
            const [currentStep, setCurrentStep] = useState(1);
            const [activeOutputTab, setActiveOutputTab] = useState('html');
            const [errors, setErrors] = useState({});
            const [isAnalyzingHS, setIsAnalyzingHS] = useState(false);
            const [isGeneratingInternal, setIsGeneratingInternal] = useState(false);
            const [isGeneratingExternal, setIsGeneratingExternal] = useState(false);
            const [isGeneratingKeywords, setIsGeneratingKeywords] = useState(false);
            const [isGeneratingFAQs, setIsGeneratingFAQs] = useState(false);
            const [optimizationMode, setOptimizationMode] = useState("SEO");
            const [sessionHistory, setSessionHistory] = useState([]); 
            const [creativeAngle, setCreativeAngle] = useState("Balanced");
            const [creativeTone, setCreativeTone] = useState("Professional");

            const [orgData, setOrgData] = useState({ orgName: "", orgUrl: "", orgLogoUrl: "", orgPhone: "", orgEmail: "", orgAreaServed: "", orgLanguage: [], orgSameAs: "", orgStreet: "", orgCity: "", orgRegion: "", orgZip: "", orgCountry: "", orgFounder: "", orgDateFounded: "", orgLegalName: "" });
            const [marketData, setMarketData] = useState({ primaryKeywords: ["", "", ""], selectedContinent: "North America", selectedCountries: [], selectedGenders: [], selectedPersonas: [], selectedIncome: [], selectedLanguages: [], analysis: "", researchPrompt: "", hsSearchQuery: "", hsCode: "" });
            const [mainCategory, setMainCategory] = useState("");
            const [subCategory, setSubCategory] = useState("");
            const [generatedAssets, setGeneratedAssets] = useState(null);
            const [specErrors, setSpecErrors] = useState({});
            const [isGeneratingTitle, setIsGeneratingTitle] = useState(false);
            const [isGeneratingDesc, setIsGeneratingDesc] = useState(false);

            const [specsData, setSpecsData] = useState({ 
                material: "", durability: "", certification: "", safety: "", eco: "", testLab: "", warranty: "", compatibility: "", packagingDimensions: "", weight: "", color: "",
                connectorType: "", length: "", powerOutput: "", transferSpeed: "", bendLifespan: "", carplay: "",
                batteryCapacity: "", chargingSpeed: "", ports: "", wirelessCharging: "", inputTime: "",
                totalWattage: "", plugType: "", ganTech: "", inputVoltage: "",
                batteryLife: "", noiseCancellation: "", driverSize: "", connectionType: "", waterproofRating: "",
                dropProtection: "", thickness: "", magSafe: "",
                size: "", fabric: "", fit: "", careInstructions: "", season: "",
                assemblyRequired: "", maxLoad: "", frameMaterial: "", upholstery: "",
                ingredients: "", allergenInfo: "", shelfLife: "", nutritionalValue: "", origin: "",
                skinType: "", volume: "", activeIngredients: "", scent: "",
                vehicle: "", partNumber: "", installation: "",
                ageGroup: "", educationalFocus: "", pieces: "",
                author: "", isbn: "", pages: "", publisher: "", language: "", format: "",
                breedSize: "", lifeStage: "", flavor: "",
                connectivity: "", sensor: "", voltage: "", powerSource: "", appControl: "",
                shoeSize: "", soleMaterial: "",
                capacity: "",
                scentNotes: "", concentration: "",
                processor: "", ram: "", storage: "", resolution: "", screenSize: ""
            });

            const [productData, setProductData] = useState({ productName: "", description: "", brandName: "", sku: "", price: "", currency: "USD", availability: "InStock", weight: "", dimensions: "", shippingInfo: "", warranty: "", condition: "NewCondition", productType: "Physical", customFields: "", productTags: "", longTailKeywords: "", semanticKeywords: "", reviewCount: "", reviewScore: "", category: "", additionalInfo: "", usp: "" });
            const [contentData, setContentData] = useState({ faqs: [], internalLinks: [], externalLinks: [], description: "", sitemapUrl: "", externalLinksPrompt: "" });

            const calculateSEOScore = () => {
                const keywordsPresent = marketData.primaryKeywords.some(kw => {
                    return kw && kw.trim() !== "" && productData.productName.toLowerCase().includes(kw.toLowerCase());
                });

                const checks = [
                    { label: "USP Defined", valid: productData.usp && productData.usp.length > 10 },
                    { label: "Description Depth (>300 chars)", valid: productData.description && productData.description.length > 300 },
                    { label: "Internal Links Added", valid: contentData.internalLinks.filter(l => l.title && l.url).length > 0 }, // Check valid content
                    { label: "External Authority Links", valid: contentData.externalLinks.filter(l => l.title && l.url).length > 0 }, // Check valid content
                    { label: "Primary Keyword in Title", valid: keywordsPresent },
                    { label: "Long Tail Keywords", valid: productData.longTailKeywords && productData.longTailKeywords.length > 10 },
                    { label: "Semantic Keywords", valid: productData.semanticKeywords && productData.semanticKeywords.length > 10 }
                ];
                
                const passed = checks.filter(c => c.valid).length;
                const total = checks.length;
                const score = Math.round((passed / total) * 100);
                
                return { checks, score };
            };

            // UPDATED: JSON-LD with MerchantReturnPolicy
            const generateJSONLD = () => {
                const schema = {
                    "@context": "https://schema.org/",
                    "@graph": [
                        {
                            "@type": "BreadcrumbList",
                            "itemListElement": [
                                { "@type": "ListItem", "position": 1, "name": "Home", "item": orgData.orgUrl || "https://example.com" },
                                { "@type": "ListItem", "position": 2, "name": mainCategory, "item": `${orgData.orgUrl}/collections/${mainCategory ? mainCategory.toLowerCase().replace(/ /g, '-') : ''}` },
                                { "@type": "ListItem", "position": 3, "name": productData.productName, "item": `${orgData.orgUrl}/products/${productData.productName ? productData.productName.toLowerCase().replace(/ /g, '-') : ''}` }
                            ]
                        },
                        {
                            "@type": "Product",
                            "@id": `${orgData.orgUrl}/products/${productData.productName ? productData.productName.toLowerCase().replace(/ /g, '-') : ''}#product`,
                            "name": productData.productName,
                            "description": productData.description ? productData.description.replace(/<[^>]*>?/gm, '') : '',
                            "brand": { "@type": "Brand", "name": productData.brandName || orgData.orgName },
                            "sku": productData.sku,
                            "mpn": productData.sku, 
                            "image": ["https://example.com/placeholder.jpg"], 
                            "offers": {
                                "@type": "Offer",
                                "url": `${orgData.orgUrl}/products/${productData.productName ? productData.productName.toLowerCase().replace(/ /g, '-') : ''}`,
                                "priceCurrency": productData.currency,
                                "price": productData.price,
                                "availability": `https://schema.org/${productData.availability}`,
                                "itemCondition": `https://schema.org/${productData.condition}`,
                                "hasMerchantReturnPolicy": {
                                    "@type": "MerchantReturnPolicy",
                                    "applicableCountry": "US",
                                    "returnPolicyCategory": "https://schema.org/MerchantReturnFiniteReturnWindow",
                                    "merchantReturnDays": 30,
                                    "returnMethod": "https://schema.org/ReturnByMail"
                                }
                            },
                            "manufacturer": { "@type": "Organization", "name": orgData.orgName },
                        },
                        {
                            "@type": "FAQPage",
                            "@id": `${orgData.orgUrl}/products/${productData.productName ? productData.productName.toLowerCase().replace(/ /g, '-') : ''}#faq`,
                            "mainEntity": contentData.faqs.map(faq => ({
                                "@type": "Question",
                                "name": faq.question,
                                "acceptedAnswer": { "@type": "Answer", "text": faq.answer }
                            }))
                        }
                    ]
                };
                return `<script type="application/ld+json">\n${JSON.stringify(schema, null, 2)}\n<\/script>`;
            };

            // UPDATED: Master Generator using D8 Template Structure with OPTIMIZATION MODES
            const generateHTML = () => {
                const slug = productData.productName ? productData.productName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '') : '';
                
                const css = `
<style>
  .d8-container { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.7; color: #1a1a1a; max-width: 100%; margin: 0 auto; text-align: left !important; }
  .d8-container h1, .d8-container h2, .d8-container h3, .d8-container p, .d8-container li, .d8-container div { text-align: left !important; }
  .d8-bluf-box { background: linear-gradient(to right, #f9f9f9, #ffffff); border-left: 4px solid #111; padding: 28px; margin-bottom: 40px; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.02); }
  .d8-bluf-title { font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; color: #444; display: block; margin-bottom: 18px; }
  .d8-bluf-list { list-style: none; padding: 0; margin: 0; }
  .d8-bluf-list li { position: relative; padding-left: 30px; margin-bottom: 14px; font-size: 16px; color: #222; }
  .d8-bluf-list li::before { content: "‚òÖ"; position: absolute; left: 0; top: 2px; color: #000; font-size: 12px; }
  .d8-highlight { font-weight: 700; color: #000; text-decoration: underline; text-decoration-color: #ddd; text-decoration-thickness: 2px; text-underline-offset: 3px; }
  .d8-section-title { font-size: 22px; font-weight: 700; margin-top: 60px; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid #eaeaea; color: #111; letter-spacing: -0.5px; }
  .d8-tech-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 50px; }
  .d8-tech-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 16px; padding: 28px; display: flex; flex-direction: column; transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
  .d8-tech-card:hover { border-color: #333; transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }
  .d8-tech-icon { font-size: 26px; margin-bottom: 15px; display: block; opacity: 0.9; }
  .d8-tech-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: #888; font-weight: 700; margin-bottom: 8px; }
  .d8-tech-value { font-size: 17px; font-weight: 700; color: #000; margin-bottom: 8px; line-height: 1.3; }
  .d8-tech-context { font-size: 14px; color: #666; line-height: 1.6; }
  .d8-trust-badge { display: flex; flex-direction: row; align-items: flex-start; background: transparent; border: 1px solid #e5e5e5; padding: 30px; border-radius: 12px; margin: 50px 0; }
  .d8-trust-icon { font-size: 32px; margin-right: 25px; line-height: 1; }
  .d8-trust-content h4 { margin: 0 0 8px 0; color: #111; font-size: 16px; font-weight: 700; }
  .d8-trust-content p { margin: 0; font-size: 15px; color: #555; }
  .d8-accordion details { background: transparent !important; border-bottom: 1px solid #f0f0f0; padding: 20px 0; }
  .d8-accordion summary { font-weight: 600; cursor: pointer; list-style: none; font-size: 17px; display: flex; justify-content: space-between; align-items: center; color: #111; padding: 5px 0; transition: color 0.2s; }
  .d8-accordion summary:hover { color: #444; }
  .d8-accordion summary::-webkit-details-marker { display: none; }
  .d8-accordion summary::after { content: "+"; font-size: 22px; font-weight:300; color: #aaa; }
  .d8-accordion details[open] summary::after { content: "‚àí"; }
  .d8-accordion p { margin-top: 15px; font-size: 15px; color: #555; padding-right: 15px; line-height: 1.7; }
  .d8-links-box { margin-top: 60px; padding-top: 30px; border-top: 1px solid #eaeaea; }
  .d8-links-title { font-size: 14px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: block; color: #333; }
  .d8-links-list { margin: 0; padding-left: 20px; }
  .d8-links-list li { margin-bottom: 8px; color: #666; }
  .d8-links-list a { color: #111 !important; text-decoration: none !important; border-bottom: 1px solid #ccc; transition: border-color 0.2s; }
  .d8-links-list a:hover { border-color: #000; }
  @media (max-width: 600px) { .d8-trust-badge { flex-direction: column; } .d8-trust-icon { margin-bottom: 15px; } .d8-tech-grid { grid-template-columns: 1fr; } .d8-bluf-box { padding: 20px; } }
</style>`;

                const breadcrumbs = `
<nav aria-label="Breadcrumb" style="margin:10px 0;">
  <ol style="list-style:none; padding:0; display:flex; gap:6px; font-size:14px;">
    <li><a href="/" style="color:#000;text-decoration:underline;">Home</a> ‚Ä∫</li>
    <li><a href="/collections/${mainCategory ? mainCategory.toLowerCase().replace(/ /g,'-') : ''}" style="color:#000;text-decoration:underline;">${mainCategory}</a> ‚Ä∫</li>
    <li><span>${productData.productName}</span></li>
  </ol>
</nav>`;

                const header = `
<div class="d8-container">
  <h1 class="d8-section-title" style="margin-top: 10px;">${productData.productName}</h1>
  <h3 style="margin: -20px 0 20px 0; font-weight: 500;">${productData.usp}</h3>`;

                // DYNAMIC CONTENT BASED ON MODE
                let blufList = "";
                let introContext = "";
                
                if (optimizationMode === "SEO") {
                     blufList = `
      <li><strong>Core Benefit:</strong> ${productData.usp}</li>
      <li><strong>Target User:</strong> Ideal for <span class="d8-highlight">${marketData.selectedPersonas[0] || 'Users'}</span>.</li>
      <li><strong>Key Spec:</strong> ${specsData.material || 'Premium Build'} with ${specsData.warranty || 'Warranty'}.</li>`;
                     introContext = `<p>${productData.description ? productData.description.replace(/\n/g, '<br>') : ''}</p>`;
                } else if (optimizationMode === "GEO") {
                     blufList = `
      <li><strong>Locale:</strong> Optimized for ${marketData.selectedContinent} region standards.</li>
      <li><strong>Currency/Value:</strong> Best in class for ${productData.currency} market.</li>
      <li><strong>Local Benefit:</strong> Tailored for ${marketData.selectedCountries[0] || 'Local'} needs.</li>`;
                     introContext = `<p><strong>Regional Focus:</strong> This product is specifically curated for the ${marketData.selectedContinent} market, ensuring full compatibility and local support.</p><p>${productData.description ? productData.description.replace(/\n/g, '<br>') : ''}</p>`;
                } else if (optimizationMode === "AEO") {
                     blufList = `
      <li><strong>Direct Answer:</strong> Yes, this is the best choice for ${productData.productName}.</li>
      <li><strong>Fast Facts:</strong> ${specsData.material}, ${specsData.warranty}, ${specsData.color}.</li>
      <li><strong>Why Buy:</strong> ${productData.usp}</li>`;
                     introContext = `<div style="background:#f0f9ff; padding:15px; border-left:4px solid #007bff; margin-bottom:20px;"><strong>Quick Answer:</strong> The ${productData.productName} offers ${productData.usp} with ${specsData.material} construction.</div><p>${productData.description ? productData.description.replace(/\n/g, '<br>') : ''}</p>`;
                } else if (optimizationMode === "AIEO") {
                     blufList = `
      <li><strong>Entity Type:</strong> ${subCategory}</li>
      <li><strong>Attributes:</strong> ${Object.keys(specsData).filter(k => specsData[k]).slice(0,3).join(', ')}</li>
      <li><strong>Sentiment:</strong> Positive User Experience Focus.</li>`;
                     introContext = `<p><strong>Data Vector:</strong> ${productData.productName} | ${orgData.orgName} | ${subCategory}</p><p>${productData.description ? productData.description.replace(/\n/g, '<br>') : ''}</p>`;
                }

                const blufContent = `
  <div class="d8-bluf-box">
    <span class="d8-bluf-title">${optimizationMode} Highlights</span>
    <ul class="d8-bluf-list">
      ${blufList}
    </ul>
  </div>`;

                // Dynamic Tech Specs Grid
                const techGrid = `
  <h2 class="d8-section-title">Technical Specifications & Benchmarks</h2>
  <div class="d8-tech-grid">
    ${Object.entries(specsData).filter(([key, val]) => val && key !== 'color').slice(0, 4).map(([key, val]) => `
    <div class="d8-tech-card">
        <span class="d8-tech-icon">‚ö°</span>
        <span class="d8-tech-label">${key.replace(/([A-Z])/g, ' $1')}</span>
        <div class="d8-tech-value">${val}</div>
        <div class="d8-tech-context">Optimized for ${optimizationMode} performance.</div>
    </div>`).join('')}
  </div>`;

                const trustBadge = `
  <div class="d8-trust-badge">
    <div class="d8-trust-icon">üõ°Ô∏è</div>
    <div class="d8-trust-content">
      <h4>Designed by ${orgData.orgName} / Quality Assured</h4>
      <p>Created by the ${orgData.orgName} design team and validated for reliability. Guaranteed ${productData.warranty} coverage.</p>
    </div>
  </div>`;

                const faqAccordion = `
  <h2 class="d8-section-title">Frequently Asked Questions</h2>
  <div class="d8-accordion">
    ${contentData.faqs.map(faq => `
    <details>
      <summary>${faq.question}</summary>
      <p>${faq.answer}</p>
    </details>`).join('')}
  </div>`;

                const internalLinks = `
  <div class="d8-links-box">
    <span class="d8-links-title">Discover More:</span>
    <ul class="d8-links-list">
      ${contentData.internalLinks.map(link => `<li><a href="${link.url}" style="color: #000; text-decoration: underline;">${link.title}</a></li>`).join('')}
      ${contentData.externalLinks.map(link => `<li><a href="${link.url}" target="_blank" style="color: #000; text-decoration: underline;">${link.title}</a></li>`).join('')}
    </ul>
  </div>
</div>`;

                const schema = generateJSONLD();

                return `${css}\n${breadcrumbs}\n${header}\n${blufContent}\n${introContext}\n${techGrid}\n${trustBadge}\n${faqAccordion}\n${internalLinks}\n\n${schema}`;
            };
            
            // NEW: Explicit definition before use
            const generateSEOOutputs = () => {
                let slug = productData.productName ? productData.productName.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '') : '';
                const isDuplicate = sessionHistory.some(p => p.url && p.url.includes(slug));
                if (isDuplicate) slug = `${slug}-${Math.floor(Math.random() * 9999)}`;
                const brand = productData.brandName || orgData.orgName || 'Brand';
                const activeSpecs = Object.entries(specsData).filter(([_, val]) => val && val.trim().length > 0).slice(0, 3).map(([_, val]) => val).join(', ');
                let productTitle = `${brand} ${productData.productName}`;
                if (activeSpecs) productTitle += ` ‚Äì ${activeSpecs}`;
                else { const keyFeatures = productData.productTags ? productData.productTags.split(',').slice(0, 2).join(', ') : 'High Quality'; productTitle += ` ‚Äì ${keyFeatures}`; }
                
                const blogTitle = `How to Choose the Best ${subCategory} for Your Needs`;
                const blogUrl = `/blog/${slug}`;
                const faqsSimple = contentData.faqs.map(f => ({ question: f.question, answer: f.answer }));
                const metaTitle = `${productTitle.substring(0, 55)}... | ${brand}`;
                const metaDesc = `Shop the ${brand} ${productData.productName}. ${productData.usp || ''} ${activeSpecs ? 'Features: ' + activeSpecs + '.' : ''} ${productData.warranty} warranty. Buy now!`.substring(0, 160);
                const productUrl = `/products/${slug}`;

                setGeneratedAssets({ productTitle, blogTitle, blogUrl, faqsJson: JSON.stringify(faqsSimple, null, 2), metaTitle, metaDesc, productUrl });
            };

            // Handlers
            const handleOrgChange = (e) => {
                const { name, value } = e.target;
                setOrgData(prev => ({...prev, [name]: value}));
                if (errors[name]) setErrors(prev => ({...prev, [name]: null}));
            };
            
            const handleSpecsChange = (e) => {
                const { name, value } = e.target;
                setSpecsData(prev => ({...prev, [name]: value}));

                let error = "";
                const numericFields = [
                    "length", "powerOutput", "batteryCapacity", "totalWattage", "inputVoltage", 
                    "batteryLife", "dropProtection", "thickness", "size", "shoeSize", 
                    "maxLoad", "shelfLife", "nutritionalValue", "volume", "weight", 
                    "pieces", "pages", "voltage", "capacity"
                ];

                if (numericFields.includes(name) && value.trim().length > 0) {
                    const hasNumber = /\d/.test(value);
                    if (!hasNumber) {
                        error = "This field usually requires a numeric value (e.g., '10kg', '500ml')";
                    }
                }

                if (name === "isbn" && value.trim().length > 0) {
                    const cleanISBN = value.replace(/[^0-9X]/gi, '');
                    if (cleanISBN.length !== 10 && cleanISBN.length !== 13) {
                        error = "ISBN should be 10 or 13 digits";
                    }
                }

                setSpecErrors(prev => ({...prev, [name]: error}));
            };

            const handleProductChange = (e) => {
                const { name, value } = e.target;
                setProductData(prev => ({...prev, [name]: value}));
                if (errors[name]) setErrors(prev => ({...prev, [name]: null}));
            };
            
            const toggleSelection = (list, item) => {
                 const currentList = list || [];
                 return currentList.includes(item) ? currentList.filter(i => i !== item) : [...currentList, item];
            };

            const handleRegionChange = (e) => {
                const newRegion = e.target.value;
                setMarketData(prev => ({...prev, selectedContinent: newRegion, selectedCountries: [] }));
                if (errors.region) setErrors(prev => ({...prev, region: null}));
            };
            
            const handleMainCategoryChange = (e) => {
                const newMain = e.target.value;
                setMainCategory(newMain);
                
                if (errors.category) {
                    setErrors(prev => ({...prev, category: null}));
                }
                
                if (newMain && PRODUCT_CATEGORIES[newMain]) {
                    const firstSubCatKey = Object.keys(PRODUCT_CATEGORIES[newMain])[0];
                    const firstSubItem = PRODUCT_CATEGORIES[newMain][firstSubCatKey][0];
                    setSubCategory(firstSubItem);
                    
                    setProductData(prev => ({
                        ...prev, 
                        category: firstSubItem,
                        productName: `${firstSubItem}` 
                    }));
                } else {
                    setSubCategory("");
                }
            };

            const handleSubCategoryChange = (e) => {
                const newSub = e.target.value;
                setSubCategory(newSub);
                
                setProductData(prev => ({
                    ...prev, 
                    category: newSub,
                    productName: `${newSub}`
                }));
            };

            const getMockHSCode = (query) => {
                const q = query.toLowerCase();
                if(q.includes("protein")) return "2106.90 - Food preparations";
                if(q.includes("coffee")) return "0901.21 - Coffee, roasted";
                if(q.includes("tea")) return "0902.10 - Green tea";
                if(q.includes("water")) return "2202.10 - Waters";
                if(q.includes("usb")) return "8544.42 - Insulated electric conductors";
                return "0000.00 (Simulated)";
            }

            const identifyHSCode = async () => {
                const query = marketData.hsSearchQuery;
                if (!query) {
                    alert("Please enter a product description first.");
                    return;
                }

                setIsAnalyzingHS(true);
                setMarketData(prev => ({...prev, hsCode: "üîç Analyzing..."}));

                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e"; 
                const prompt = `Identify HS Code for: "${query}". STRICTLY return code + title.`;

                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({
                            model: "deepseek-chat",
                            messages: [{ role: "user", content: prompt }],
                            temperature: 0.3
                        })
                    });

                    const data = await response.json();
                    if (data.choices && data.choices[0]) {
                        setMarketData(prev => ({...prev, hsCode: data.choices[0].message.content.trim()}));
                    } else {
                        throw new Error("No content");
                    }
                } catch (error) {
                    console.warn("HS Code Error:", error);
                    setMarketData(prev => ({...prev, hsCode: `${getMockHSCode(query)} (Offline)`}));
                } finally {
                    setIsAnalyzingHS(false);
                }
            };

            const validateStep = () => {
                const newErrors = {};
                switch(currentStep) {
                    case 1:
                        if (!orgData.orgName || !orgData.orgName.trim()) newErrors.orgName = "Required.";
                        break;
                    case 2:
                        if (!marketData.selectedContinent) newErrors.region = "Required.";
                        break;
                    case 3:
                        if (!mainCategory || !subCategory) newErrors.category = "Required.";
                        break;
                    case 4:
                        if (!productData.productName || !productData.productName.trim()) newErrors.productName = "Required.";
                        break;
                    default: break;
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleNextStep = () => {
                if (!validateStep()) {
                    if(Object.keys(errors).length > 0) alert("Please fix errors");
                    return;
                }
                setCurrentStep(currentStep + 1);
            };

            const resetProject = () => {
                if(confirm("Reset project?")) window.location.reload();
            };

            const submitProject = () => {
                if (confirm("Confirm submission?")) alert("‚úÖ Project Submitted Successfully!");
            };

            const exportData = () => {
                const blob = new Blob([JSON.stringify({orgData, marketData, specsData, productData, contentData, generatedAssets}, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = "seo-geo-data.json";
                a.click();
            };

            // NEW FUNCTION: Save Session Data & Reset Product Fields for Mass Generation
            const saveAndNextProduct = () => {
                // 1. Add current successful product to History
                setSessionHistory(prev => [...prev, { 
                    name: productData.productName, 
                    url: generatedAssets?.productUrl,
                    sku: productData.sku
                }]);

                // 2. Randomize the "Creativity Matrix" for the next run
                const angles = ["Technical", "Lifestyle", "Professional", "Minimalist", "Urgency", "Safety-First"];
                const tones = ["Authoritative", "Friendly", "Exciting", "Trustworthy", "Sophisticated"];
                setCreativeAngle(angles[Math.floor(Math.random() * angles.length)]);
                setCreativeTone(tones[Math.floor(Math.random() * tones.length)]);

                // 3. Clear Product-Specific Data BUT Keep Config Data (Org, Market Strategy)
                setProductData({
                    productName: "", 
                    description: "", 
                    brandName: productData.brandName, // Keep Brand
                    sku: "", 
                    price: productData.price, // Keep Price Logic usually
                    currency: productData.currency, 
                    availability: "InStock", 
                    weight: "", 
                    dimensions: "", 
                    shippingInfo: productData.shippingInfo, // Keep Shipping
                    warranty: productData.warranty, // Keep Warranty
                    condition: "NewCondition", 
                    productType: "Physical", 
                    customFields: "", 
                    productTags: "", 
                    longTailKeywords: "",
                    semanticKeywords: "", 
                    reviewCount: "", 
                    reviewScore: "", 
                    category: productData.category,
                    additionalInfo: "",
                    usp: "" 
                });
                
                // 4. Reset Generated Output
                setGeneratedAssets(null);

                // 5. Send user back to Step 4 (Product Intelligence) to enter next item
                setCurrentStep(4);
                alert("Product saved to Session History! Ready for next item. \n\nCreativity Matrix Randomized for uniqueness.");
            };

            const autoGenerateKeywords = async () => {
                setIsGeneratingKeywords(true);
                const productName = productData.productName || subCategory || "Product";
                const category = mainCategory || "General";
                const persona = marketData.selectedPersonas.join(', ') || "General Audience";
                const region = marketData.selectedCountries.join(', ') || "Global";
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";

                const prompt = `Act as a SEO Strategist. Generate keyword strategy for: ${productName} (${category}), Audience: ${persona}, Region: ${region}. Output JSON: { "primary": [], "longTail": [], "semantic": [] }`;

                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({
                            model: "deepseek-chat",
                            messages: [{ role: "user", content: prompt }],
                            temperature: 0.4,
                            response_format: { type: "json_object" }
                        })
                    });
                    const data = await response.json();
                    if (data.choices && data.choices[0]) {
                        const result = JSON.parse(data.choices[0].message.content);
                        setMarketData(prev => ({ ...prev, primaryKeywords: result.primary || [] }));
                        setProductData(prev => ({
                            ...prev,
                            longTailKeywords: (result.longTail || []).join(', '),
                            semanticKeywords: (result.semantic || []).join(', ')
                        }));
                    }
                } catch (error) {
                    console.error("Keyword Error", error);
                } finally {
                    setIsGeneratingKeywords(false);
                }
            };

            // UPDATED: Context-Aware AI Prompting based on Optimization Mode & Session History
            const getContextPrompt = (baseContext) => {
                // 1. Anti-Duplication Logic: Inject "Negative Constraints" from History
                const recentTitles = sessionHistory.slice(-5).map(p => p.name).join(", ");
                const negativeConstraint = recentTitles ? `Do NOT generate titles/content similar to these recent ones: ${recentTitles}. ` : "";
                
                // 2. Creativity Matrix Injection
                const creativityInstruction = `Use a ${creativeAngle} angle and a ${creativeTone} tone. `;

                let modeInstruction = "";
                if (optimizationMode === "SEO") modeInstruction = "Focus on keyword density (1-2%), clear H1/H2 structure, and persuasive copy for Google ranking.";
                if (optimizationMode === "GEO") modeInstruction = "Focus on conversational tone, rich detail, problem-solving, and user intent for AI search engines (SearchGPT, Perplexity).";
                if (optimizationMode === "AEO") modeInstruction = "Focus on Q&A format, concise definitions, and direct answers for Voice Search and Featured Snippets.";
                if (optimizationMode === "AIEO") modeInstruction = "Focus on structured data points, entity relationships, sentiment analysis terms, and technical accuracy for LLM training.";
                
                return `${baseContext} \n\nCONSTRAINTS: ${negativeConstraint} \nSTYLE: ${creativityInstruction} \nGOAL: ${modeInstruction}`;
            };

            const generateSmartTitle = async () => {
                setIsGeneratingTitle(true);
                const basePrompt = `Generate a single, short, and precise product title for ${productData.productName} (${subCategory}). Brand: ${orgData.orgName}. Specs: ${Object.values(specsData).filter(Boolean).join(', ')}. Output ONLY the raw title text. Do not use markdown, HTML tags (<h1>), or labels.`;
                const prompt = getContextPrompt(basePrompt);
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.7 }) 
                    });
                    const data = await response.json();
                    if (data.choices) {
                        let cleanTitle = data.choices[0].message.content.trim();
                        // Clean up Markdown/HTML artifacts
                        cleanTitle = cleanTitle.replace(/^"|"$/g, '')
                                               .replace(/<\/?[^>]+(>|$)/g, "") // Remove HTML tags
                                               .replace(/^(H1:|Title:|Product Name:)/i, "") // Remove common AI prefixes
                                               .replace(/[#*`]/g, "") // Remove Markdown chars
                                               .trim();
                        setProductData(prev => ({...prev, productName: cleanTitle}));
                    }
                } catch (error) { console.warn(error); } 
                finally { setIsGeneratingTitle(false); }
            };

            const generateSmartDescription = async () => {
                setIsGeneratingDesc(true);
                // Updated prompt for precise, in-depth content > 300 chars
                const basePrompt = `Write a precise and in-depth Product Description (minimum 300 words) for ${productData.productName}. USP: ${productData.usp}. Specs: ${Object.values(specsData).filter(Boolean).join(', ')}. Ensure it is factual, detailed, and optimized for the selected strategy.`;
                const prompt = getContextPrompt(basePrompt);
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.7 }) // High temp for variety
                    });
                    const data = await response.json();
                    if (data.choices) setProductData(prev => ({...prev, description: data.choices[0].message.content.trim()}));
                } catch (error) { console.warn(error); }
                finally { setIsGeneratingDesc(false); }
            };
            
            const generateResearchStrategy = () => {
                 setMarketData(prev => ({...prev, analysis: `STRATEGY: ${marketData.selectedCountries.join(', ')} | ${marketData.selectedPersonas.join(', ')} | HS: ${marketData.hsCode}`}));
            };

            const generateAIReport = async () => {
                if(!marketData.hsCode) return alert("Missing HS Code");
                setMarketData(prev => ({...prev, researchPrompt: "Generating Report..."}));
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                const prompt = `Generate Market Report for ${productData.productName}, HS Code ${marketData.hsCode}, Regions: ${marketData.selectedCountries.join(', ')}. Include Duties & Competitors.`;
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.5 })
                    });
                    const data = await response.json();
                    if(data.choices) setMarketData(prev => ({...prev, researchPrompt: data.choices[0].message.content}));
                } catch(e) { console.error(e); setMarketData(prev => ({...prev, researchPrompt: "Error generating report."})); }
            };
            
            const generateInternalStrategy = async () => {
                setIsGeneratingInternal(true);
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                // Use 'domain' context if provided, otherwise rely on generic suggestions
                const domainContext = contentData.sitemapUrl ? `on domain ${contentData.sitemapUrl}` : `for a general e-commerce site`;
                const prompt = `Suggest 3 internal blog links for ${productData.productName} ${domainContext}. JSON Array of {title, url}.`;
                
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                         method: "POST",
                         headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                         body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.3 })
                    });
                    const data = await response.json();
                    
                    const content = data.choices[0].message.content;
                    // Improved Regex to catch JSON array even if wrapped in text
                    const jsonStartIndex = content.indexOf('[');
                    const jsonEndIndex = content.lastIndexOf(']') + 1;
                    
                    if (jsonStartIndex !== -1 && jsonEndIndex !== -1) {
                        const jsonString = content.substring(jsonStartIndex, jsonEndIndex);
                        const links = JSON.parse(jsonString);
                        setContentData(prev => ({...prev, internalLinks: links}));
                    } else {
                        // Fallback if JSON parsing fails
                        setContentData(prev => ({...prev, internalLinks: [{title: "Guide to " + productData.productName, url: "/blog/guide"}]}));
                    }
                } catch(e) { 
                    console.error(e); 
                    // Fallback on error
                    setContentData(prev => ({...prev, internalLinks: [{title: "Related Product", url: "/products/related"}]}));
                } finally { setIsGeneratingInternal(false); }
            };

            const generateExternalStrategy = async () => {
                setIsGeneratingExternal(true);
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                const prompt = `Identify 3 high-authority external sources (Wikipedia, Standards Bodies, Gov) for ${productData.productName}. JSON Array of {title, url}.`;
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                         method: "POST",
                         headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                         body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.3 })
                    });
                    const data = await response.json();
                    
                    const content = data.choices[0].message.content;
                    const jsonStartIndex = content.indexOf('[');
                    const jsonEndIndex = content.lastIndexOf(']') + 1;
                    
                    if (jsonStartIndex !== -1 && jsonEndIndex !== -1) {
                        const jsonString = content.substring(jsonStartIndex, jsonEndIndex);
                        const links = JSON.parse(jsonString);
                        setContentData(prev => ({...prev, externalLinks: links}));
                    }
                } catch(e) { console.error(e); } finally { setIsGeneratingExternal(false); }
            };
            
            const generateFAQs = async () => {
                setIsGeneratingFAQs(true); 
                const apiKey = "sk-e60ffbda1c804c01b31353bdfd441f1e";
                const seed = Math.floor(Math.random() * 10000);
                const prompt = `Generate 5 unique FAQs for: ${productData.productName}. Context: ${productData.description}. Target Audience: ${marketData.selectedPersonas.join(', ')}. Seed: ${seed}. Creative Angle: ${creativeAngle}. Requirements: 1. Questions specific to persona. 2. Factual answers. 3. Output STRICTLY valid JSON array: [{"question": "...", "answer": "..."}]. 4. No markdown.`;
                try {
                    const response = await fetch(`https://api.deepseek.com/chat/completions`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                        body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "user", content: prompt }], temperature: 0.7 })
                    });
                    const data = await response.json();
                    if (data.choices) {
                         const content = data.choices[0].message.content;
                         const jsonStartIndex = content.indexOf('[');
                         const jsonEndIndex = content.lastIndexOf(']') + 1;
                         if (jsonStartIndex !== -1) {
                             const jsonString = content.substring(jsonStartIndex, jsonEndIndex);
                             const parsed = JSON.parse(jsonString);
                             setContentData(prev => ({...prev, faqs: parsed}));
                         }
                    }
                } catch (error) { console.error("FAQ Gen Error", error); } finally { setIsGeneratingFAQs(false); }
            };
            
            const addInternalLink = () => setContentData(prev => ({...prev, internalLinks: [...prev.internalLinks, {title: "", url: ""}]}));
            const updateInternalLink = (idx, field, val) => { const newLinks = [...contentData.internalLinks]; newLinks[idx][field] = val; setContentData(prev => ({...prev, internalLinks: newLinks})); };
            const removeInternalLink = (idx) => setContentData(prev => ({...prev, internalLinks: contentData.internalLinks.filter((_, i) => i !== idx)}));
            
            const addExternalLink = () => setContentData(prev => ({...prev, externalLinks: [...prev.externalLinks, {title: "", url: ""}]}));
            const updateExternalLink = (idx, field, val) => { const newLinks = [...contentData.externalLinks]; newLinks[idx][field] = val; setContentData(prev => ({...prev, externalLinks: newLinks})); };
            const removeExternalLink = (idx) => setContentData(prev => ({...prev, externalLinks: contentData.externalLinks.filter((_, i) => i !== idx)}));

            // --- RENDER STEPS ---
            const renderStepContent = () => {
                switch(currentStep) {
                    case 1: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Building className="text-blue-600"/> Organization Governance</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 mb-6">
                                <h3 className="text-sm font-bold text-gray-900 uppercase border-b pb-2">A. Basic Information</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Organization Name" name="orgName" value={orgData.orgName} onChange={handleOrgChange} placeholder="e.g. Acme Corp" error={errors.orgName} required />
                                    <InputField label="URL" name="orgUrl" value={orgData.orgUrl} onChange={handleOrgChange} placeholder="https://www.example.com" error={errors.orgUrl} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Logo URL" name="orgLogoUrl" value={orgData.orgLogoUrl} onChange={handleOrgChange} placeholder="https://www.example.com/logo.png" />
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 mb-6">
                                <h3 className="text-sm font-bold text-gray-900 uppercase border-b pb-2">B. Contact Information</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Telephone" name="orgPhone" value={orgData.orgPhone} onChange={handleOrgChange} placeholder="+1-555-010-9988" />
                                    <InputField label="Email" name="orgEmail" value={orgData.orgEmail} onChange={handleOrgChange} placeholder="contact@example.com" error={errors.orgEmail} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Area Served" name="orgAreaServed" value={orgData.orgAreaServed} onChange={handleOrgChange} placeholder="e.g. Global, North America" />
                                    <MultiSelectDropdown label="Available Languages" options={LANGUAGES} selected={orgData.orgLanguage} onChange={(item) => setOrgData({...orgData, orgLanguage: toggleSelection(orgData.orgLanguage, item)})} />
                                </div>
                                <TextArea label="SameAs (Social Profiles)" name="orgSameAs" value={orgData.orgSameAs} onChange={handleOrgChange} placeholder="https://facebook.com/yourbrand&#10;https://twitter.com/yourbrand" />
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 mb-6">
                                <h3 className="text-sm font-bold text-gray-900 uppercase border-b pb-2">C. Location/Address Information</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Street Address" name="orgStreet" value={orgData.orgStreet} onChange={handleOrgChange} placeholder="123 Innovation Drive" />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Locality (City)" name="orgCity" value={orgData.orgCity} onChange={handleOrgChange} placeholder="New York" />
                                    <InputField label="Region (State)" name="orgRegion" value={orgData.orgRegion} onChange={handleOrgChange} placeholder="NY" />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Postal Code" name="orgZip" value={orgData.orgZip} onChange={handleOrgChange} placeholder="10001" />
                                    <InputField label="Country" name="orgCountry" value={orgData.orgCountry} onChange={handleOrgChange} placeholder="USA" />
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 mb-6">
                                <h3 className="text-sm font-bold text-gray-900 uppercase border-b pb-2">D. Additional Information</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Founder" name="orgFounder" value={orgData.orgFounder} onChange={handleOrgChange} placeholder="e.g. John Doe" />
                                    <InputField label="Date Founded" name="orgDateFounded" value={orgData.orgDateFounded} onChange={handleOrgChange} type="date" />
                                </div>
                                <InputField label="Legal Name" name="orgLegalName" value={orgData.orgLegalName} onChange={handleOrgChange} placeholder="e.g. Acme Corporation Ltd." />
                            </div>
                        </div>
                    );
                    case 2: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Globe className="text-blue-600"/> Global Market Strategy</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-6">
                                <div>
                                    <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Primary Keywords (Top 3)</label>
                                    <div className="grid grid-cols-3 gap-2 mb-4">
                                        {marketData.primaryKeywords.map((kw, i) => (
                                            <input key={i} className="w-full p-2 border border-gray-300 rounded-lg text-sm" value={kw} onChange={(e) => { const newKw = [...marketData.primaryKeywords]; newKw[i] = e.target.value; setMarketData({...marketData, primaryKeywords: newKw}); }} />
                                        ))}
                                    </div>
                                    <div className="mb-4">
                                        <label className={`block text-xs font-bold uppercase mb-1 tracking-wider ${errors.region ? 'text-red-500' : 'text-gray-500'}`}>Target Region</label>
                                        <div className="relative">
                                            <select value={marketData.selectedContinent} onChange={handleRegionChange} className="w-full pl-3 pr-8 py-2.5 border rounded-lg text-sm focus:ring-2 outline-none bg-white text-gray-700">
                                                <option value="">-- Select Region --</option>
                                                {Object.keys(CONTINENTS).map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    {marketData.selectedContinent && (
                                        <div className="mt-3 animate-fadeIn">
                                            <MultiSelectDropdown label={`Specific Countries in ${marketData.selectedContinent}`} options={CONTINENTS[marketData.selectedContinent]} selected={marketData.selectedCountries} onChange={(item) => setMarketData({...marketData, selectedCountries: toggleSelection(marketData.selectedCountries, item)})} />
                                        </div>
                                    )}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <CheckboxGroup label="Gender" options={GENDERS} selected={marketData.selectedGenders} onChange={(i) => setMarketData({...marketData, selectedGenders: toggleSelection(marketData.selectedGenders, i)})} />
                                    <CheckboxGroup label="Income Group" options={INCOME_GROUPS} selected={marketData.selectedIncome} onChange={(i) => setMarketData({...marketData, selectedIncome: toggleSelection(marketData.selectedIncome, i)})} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <MultiSelectDropdown label="Target Persona" options={PERSONAS} selected={marketData.selectedPersonas} onChange={(i) => setMarketData({...marketData, selectedPersonas: toggleSelection(marketData.selectedPersonas, i)})} />
                                    <CheckboxGroup label="Target Languages" options={LANGUAGES} selected={marketData.selectedLanguages} onChange={(i) => setMarketData({...marketData, selectedLanguages: toggleSelection(marketData.selectedLanguages, i)})} />
                                </div>
                                <div className="bg-slate-100 border border-slate-200 p-4 rounded-lg mt-2">
                                    <h3 className="text-sm font-bold text-slate-800 flex items-center gap-2 mb-3 uppercase tracking-wider"><Search size={14} /> HS Code Intelligence</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="flex gap-2">
                                            <input className="w-full p-2 border border-gray-300 rounded-lg text-sm" placeholder="e.g. USB Cable" value={marketData.hsSearchQuery} onChange={(e) => setMarketData({...marketData, hsSearchQuery: e.target.value})} />
                                            <button onClick={identifyHSCode} disabled={isAnalyzingHS} className="bg-purple-600 text-white px-3 rounded-lg hover:bg-purple-700 min-w-[50px] flex items-center justify-center">
                                                {isAnalyzingHS ? <Loader className="animate-spin" size={16} /> : <MagicWand size={16} />}
                                            </button>
                                        </div>
                                        <input className="w-full p-2 border border-gray-300 rounded-lg text-sm bg-white font-mono text-blue-800 font-bold" placeholder="0000.00.00" value={marketData.hsCode} onChange={(e) => setMarketData({...marketData, hsCode: e.target.value})} />
                                    </div>
                                </div>
                                <div className="flex gap-4 border-t pt-4">
                                    <button onClick={generateResearchStrategy} className="w-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold">1. Build Strategy</button>
                                    <button onClick={generateAIReport} className="w-1/2 bg-purple-600 text-white px-4 py-2 rounded-lg text-sm font-bold">2. AI Generated Report</button>
                                </div>
                                {marketData.analysis && <textarea className="w-full p-3 border rounded-lg bg-blue-50 text-sm h-64 mt-4" value={marketData.analysis} readOnly />}
                                {marketData.researchPrompt && <textarea className="w-full p-3 border rounded-lg bg-purple-50 text-sm h-64 mt-4" value={marketData.researchPrompt} readOnly />}
                            </div>
                        </div>
                    );
                    case 3: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Wrench className="text-blue-600"/> Engineering Specs</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4">
                                <div className="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100 grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className={`block text-xs font-bold mb-1 uppercase tracking-wider ${errors.category ? 'text-red-600' : 'text-blue-900'}`}>Industry / Main Category</label>
                                        <select value={mainCategory} onChange={handleMainCategoryChange} className={`w-full p-3 border rounded-lg outline-none bg-white font-medium text-gray-700 ${errors.category ? 'border-red-300' : 'border-blue-300'}`}>
                                            <option value="">-- Select Industry --</option>
                                            {Object.keys(PRODUCT_CATEGORIES).map(cat => (<option key={cat} value={cat}>{cat}</option>))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className={`block text-xs font-bold mb-1 uppercase tracking-wider ${errors.category ? 'text-red-600' : 'text-blue-900'}`}>Product Type</label>
                                        <select value={subCategory} onChange={handleSubCategoryChange} className={`w-full p-3 border rounded-lg outline-none bg-white font-medium text-gray-700 ${errors.category ? 'border-red-300' : 'border-blue-300'}`} disabled={!mainCategory}>
                                            <option value="">-- Select Type --</option>
                                            {mainCategory && PRODUCT_CATEGORIES[mainCategory] && Object.keys(PRODUCT_CATEGORIES[mainCategory]).map(group => (
                                                <optgroup key={group} label={group}>
                                                    {PRODUCT_CATEGORIES[mainCategory][group].map(item => (<option key={item} value={item}>{item}</option>))}
                                                </optgroup>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                                {(() => {
                                    if (!subCategory) return <div className="col-span-2 p-12 text-center border-2 border-dashed border-gray-300 rounded-xl bg-gray-50"><h3 className="text-gray-600 font-bold">No Product Type Selected</h3></div>;
                                    
                                    return (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 animate-fadeIn">
                                            <InputField label="Material" name="material" value={specsData.material} onChange={handleSpecsChange} error={specErrors.material} placeholder="e.g. Plastic, Metal" />
                                            <InputField label="Dimensions" name="packagingDimensions" value={specsData.packagingDimensions} onChange={handleSpecsChange} error={specErrors.packagingDimensions} placeholder="e.g. 10x10 cm" />
                                            <InputField label="Weight" name="weight" value={specsData.weight} onChange={handleSpecsChange} error={specErrors.weight} placeholder="e.g. 1kg" />
                                            <InputField label="Color" name="color" value={specsData.color} onChange={handleSpecsChange} placeholder="e.g. Black" />
                                        </div>
                                    );
                                })()}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Warranty" name="warranty" value={specsData.warranty} onChange={handleSpecsChange} placeholder="e.g. 1 Year" />
                                    <InputField label="Certification" name="certification" value={specsData.certification} onChange={handleSpecsChange} placeholder="e.g. CE, RoHS" />
                                </div>
                            </div>
                        </div>
                    );
                    case 4: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Zap className="text-blue-600"/> Product Intelligence</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4">
                                <InputField label="Product Name" name="productName" value={productData.productName} onChange={handleProductChange} error={errors.productName} required icon={Zap} action={<button onClick={generateSmartTitle} disabled={isGeneratingTitle} className="text-xs px-3 py-1.5 rounded-lg font-bold flex items-center gap-2 bg-blue-50 text-blue-600">{isGeneratingTitle ? <Loader size={14} className="animate-spin"/> : <MagicWand size={14}/>} AI Title</button>} />
                                
                                <TextArea 
                                    label="Product Description" 
                                    name="description" 
                                    value={productData.description} 
                                    onChange={handleProductChange} 
                                    action={<button onClick={generateSmartDescription} disabled={isGeneratingDesc} className="text-xs px-3 py-1.5 rounded-lg font-bold flex items-center gap-2 bg-blue-50 text-blue-600">{isGeneratingDesc ? <Loader size={14} className="animate-spin"/> : <MagicWand size={14}/>} AI Description</button>} 
                                />

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Brand Name" name="brandName" value={productData.brandName} onChange={handleProductChange} />
                                    <InputField label="SKU" name="sku" value={productData.sku} onChange={handleProductChange} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Price" name="price" value={productData.price} onChange={handleProductChange} />
                                    <InputField label="Currency" name="currency" value={productData.currency} onChange={handleProductChange} />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Weight" name="weight" value={productData.weight} onChange={handleProductChange} placeholder="e.g. 1.5 kg / 3.3 lbs" />
                                    <InputField label="Dimensions" name="dimensions" value={productData.dimensions} onChange={handleProductChange} placeholder="e.g. 10 x 5 x 2 inches" />
                                </div>
                                <TextArea label="Shipping Information" name="shippingInfo" value={productData.shippingInfo} onChange={handleProductChange} placeholder="e.g. Free Shipping..." />
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputField label="Warranty" name="warranty" value={productData.warranty} onChange={handleProductChange} placeholder="e.g. 2 Year Manufacturer Warranty" />
                                    <InputField label="Product Condition" name="condition" value={productData.condition} onChange={handleProductChange} placeholder="e.g. NewCondition" />
                                </div>
                                <InputField label="Product Tags" name="productTags" value={productData.productTags} onChange={handleProductChange} required error={errors.productTags} />
                            </div>
                        </div>
                    );
                    case 5: 
                        const { checks, score } = calculateSEOScore();
                        return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><PenTool className="text-blue-600"/> Content Engine</h2>
                            
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-6">
                                <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="text-sm font-bold text-blue-800 flex items-center gap-2"><Search size={14}/> Keyword Strategy</h3>
                                        <button onClick={autoGenerateKeywords} disabled={isGeneratingKeywords} className="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 flex items-center gap-1">
                                            {isGeneratingKeywords ? <Loader className="animate-spin" size={12}/> : <MagicWand size={12}/>} Auto-Generate
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 gap-3 text-sm">
                                        <div><span className="font-bold text-gray-600 block text-xs uppercase">Primary</span> <span className="text-blue-700 font-mono">{marketData.primaryKeywords.filter(k=>k).join(', ')}</span></div>
                                        <div><span className="font-bold text-gray-600 block text-xs uppercase">Long-tail</span> <span className="text-gray-700 font-mono">{productData.longTailKeywords}</span></div>
                                        <div><span className="font-bold text-gray-600 block text-xs uppercase">Semantic (LSI)</span> <span className="text-gray-700 font-mono italic">{productData.semanticKeywords}</span></div>
                                    </div>
                                </div>
                                
                                <div className="grid grid-cols-1 gap-4">
                                    <TextArea label="Product USP" name="usp" value={productData.usp} onChange={handleProductChange} placeholder="Unique Selling Proposition..." />
                                    <TextArea label="Additional Info" name="additionalInfo" value={productData.additionalInfo} onChange={handleProductChange} placeholder="Extra content..." />
                                </div>
                                
                                <div>
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="text-sm font-bold text-gray-900">Internal Linking Strategy</h3>
                                        <div className="flex gap-2">
                                            <button onClick={generateInternalStrategy} disabled={isGeneratingInternal} className="bg-purple-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-purple-700 flex items-center gap-1">
                                                {isGeneratingInternal ? <Loader className="animate-spin" size={12} /> : <MagicWand size={12}/>} AI Suggest
                                            </button>
                                            <button onClick={addInternalLink} className="text-xs flex items-center gap-1 text-blue-600 font-bold"><Plus size={12}/> Add</button>
                                        </div>
                                    </div>
                                    <input placeholder="Enter Sitemap URL (e.g., yoursite.com/sitemap.xml)" className="w-full p-2 border rounded text-xs mb-2" value={contentData.sitemapUrl || ""} onChange={(e) => setContentData({...contentData, sitemapUrl: e.target.value})} />
                                    <div className="space-y-2 bg-gray-50 p-3 rounded border">
                                        {contentData.internalLinks.map((link, idx) => (
                                            <div key={idx} className="flex gap-2 items-center">
                                                <input placeholder="Title" className="flex-1 p-2 border rounded text-xs" value={link.title} onChange={(e) => updateInternalLink(idx, 'title', e.target.value)} />
                                                <input placeholder="URL" className="flex-1 p-2 border rounded text-xs" value={link.url} onChange={(e) => updateInternalLink(idx, 'url', e.target.value)} />
                                                <button onClick={() => removeInternalLink(idx)} className="text-red-400 hover:text-red-600"><Trash size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="mt-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="text-sm font-bold text-gray-900">External Authority Links</h3>
                                        <div className="flex gap-2">
                                            <button onClick={generateExternalStrategy} disabled={isGeneratingExternal} className="bg-purple-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-purple-700 flex items-center gap-1">
                                                {isGeneratingExternal ? <Loader className="animate-spin" size={12} /> : <MagicWand size={12}/>} AI Find Sources
                                            </button>
                                            <button onClick={addExternalLink} className="text-xs flex items-center gap-1 text-blue-600 font-bold"><Plus size={12}/> Add</button>
                                        </div>
                                    </div>
                                    <div className="space-y-2 bg-gray-50 p-3 rounded border">
                                        {contentData.externalLinks.map((link, idx) => (
                                            <div key={idx} className="flex gap-2 items-center">
                                                <input placeholder="Title" className="flex-1 p-2 border rounded text-xs" value={link.title} onChange={(e) => updateExternalLink(idx, 'title', e.target.value)} />
                                                <input placeholder="URL" className="flex-1 p-2 border rounded text-xs" value={link.url} onChange={(e) => updateExternalLink(idx, 'url', e.target.value)} />
                                                <button onClick={() => removeExternalLink(idx)} className="text-red-400 hover:text-red-600"><Trash size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* NEW: FAQ GENERATOR SECTION */}
                                <div className="mt-6 mb-4">
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="text-sm font-bold text-gray-900">Frequently Asked Questions</h3>
                                        <button onClick={generateFAQs} disabled={isGeneratingFAQs} className="bg-indigo-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-indigo-700 flex items-center gap-1">
                                             {isGeneratingFAQs ? <Loader className="animate-spin" size={12}/> : <MagicWand size={12}/>} AI Auto-Generate FAQs
                                        </button>
                                    </div>
                                    <div className="space-y-2 bg-gray-50 p-3 rounded border">
                                        {contentData.faqs.map((faq, idx) => (
                                            <div key={idx} className="border-b last:border-0 pb-2 mb-2">
                                                <p className="font-bold text-xs text-gray-800">Q: {faq.question}</p>
                                                <p className="text-xs text-gray-600">A: {faq.answer}</p>
                                            </div>
                                        ))}
                                        {contentData.faqs.length === 0 && <p className="text-xs text-gray-400 italic">No FAQs generated yet. Click the button above.</p>}
                                    </div>
                                </div>

                                {/* CONTENT OPTIMIZATION SCORE - MOVED HERE */}
                                <div className="mt-6 mb-6 bg-white border border-gray-200 rounded-xl p-4 shadow-sm">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wider">Content Optimization Score</h3>
                                        <div className={`text-lg font-bold ${score === 100 ? 'text-green-600' : score > 50 ? 'text-yellow-600' : 'text-red-600'}`}>{score}% Ready</div>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2 mb-4">
                                        <div className={`h-2 rounded-full transition-all duration-500 ${score === 100 ? 'bg-green-500' : 'bg-blue-500'}`} style={{width: `${score}%`}}></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                        {checks.map((check, i) => (
                                            <div key={i} className="flex items-center gap-2 text-xs">
                                                {check.valid ? <Check size={14} className="text-green-500"/> : <div className="w-3.5 h-3.5 rounded-full border border-gray-300"></div>}
                                                <span className={check.valid ? "text-gray-700" : "text-gray-400"}>{check.label}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-6 bg-indigo-50 border border-indigo-100 rounded-xl p-5 shadow-sm">
                                    <h3 className="text-sm font-bold text-indigo-900 uppercase tracking-wider mb-3 flex items-center gap-2">
                                        <Activity size={16} /> Optimization Focus Strategy
                                    </h3>
                                    <p className="text-xs text-indigo-700 mb-4">Select the primary algorithm ranking logic for the generated content.</p>
                                    <div className="relative">
                                        <select value={optimizationMode} onChange={(e) => setOptimizationMode(e.target.value)} className="w-full p-3 border border-indigo-200 rounded-lg text-sm font-bold text-indigo-900 bg-white focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer hover:border-indigo-300">
                                            <option value="SEO">SEO - Search Engine Optimization (Standard Web)</option>
                                            <option value="GEO">GEO - Generative Engine Optimization (AI Search)</option>
                                            <option value="AEO">AEO - Answer Engine Optimization (Voice & Snippets)</option>
                                            <option value="AIEO">AIEO - AI Engine Optimization (LLMs & Knowledge Graphs)</option>
                                        </select>
                                        <ChevronDown className="absolute right-3 top-3.5 text-indigo-400 pointer-events-none" size={16} />
                                    </div>
                                    
                                    {/* Visual Feedback for Selected Mode */}
                                    <div className="mt-3 p-3 bg-white rounded-lg border border-indigo-100 text-xs text-indigo-800">
                                        {optimizationMode === 'SEO' && <span><strong>Target:</strong> Google/Bing SERPs. <strong>Format:</strong> Standard Article. <strong>Goal:</strong> High CTR & Keyword Ranking.</span>}
                                        {optimizationMode === 'GEO' && <span><strong>Target:</strong> Generative Engines (Perplexity, SGE). <strong>Format:</strong> Citation-heavy, comparative lists, authoritative definitions. <strong>Goal:</strong> Primary Source Citation.</span>}
                                        {optimizationMode === 'AEO' && <span><strong>Target:</strong> Voice Search (Siri/Alexa) & Featured Snippets. <strong>Format:</strong> Q&A, Concise Answers. <strong>Goal:</strong> Zero-Click Position.</span>}
                                        {optimizationMode === 'AIEO' && <span><strong>Target:</strong> LLMs (ChatGPT/Claude) & Knowledge Graphs. <strong>Format:</strong> Structured Data, Entity Vectors. <strong>Goal:</strong> Brand Authority in AI Training.</span>}
                                    </div>
                                </div>

                                <div className="border-t pt-6">
                                    <h3 className="text-lg font-bold text-gray-800 mb-2">Product Content Generator (HTML + Schema)</h3>
                                    <div className="flex gap-2">
                                        <button onClick={() => setContentData({...contentData, generated: true})} className="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow-sm flex items-center gap-2 hover:bg-blue-700 w-full justify-center">
                                            <Zap size={18}/> Generate Optimized Content
                                        </button>
                                    </div>
                                    {contentData.generated && (
                                        <div className="mt-4 border rounded-lg overflow-hidden animate-fade-in">
                                            <div className="bg-gray-100 px-4 py-2 border-b text-xs font-bold text-gray-500 flex justify-between"><span>PREVIEW</span><CopyButton text={generateHTML()} /></div>
                                            <div className="p-4 bg-gray-50 h-64 overflow-y-auto font-mono text-xs text-gray-700 whitespace-pre-wrap">{generateHTML()}</div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    );
                    case 6: 
                        return (
                        <div className="w-full h-full flex flex-col bg-white p-6 overflow-y-auto">
                            <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                                <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2"><Code className="text-blue-600"/> Optimized SEO & GEO Assets</h2>
                                <div className="flex gap-2">
                                    <button onClick={resetProject} className="bg-white border border-gray-300 text-gray-600 hover:bg-red-50 px-4 py-2.5 rounded-lg font-bold flex items-center gap-2"><RotateCcw size={16} /> New</button>
                                    <button onClick={saveAndNextProduct} className="bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-4 py-2.5 rounded-lg font-bold flex items-center gap-2 transition-colors"><Plus size={16} /> Save & Next Product</button>
                                    <button onClick={exportData} className="bg-gray-100 text-gray-700 px-4 py-2.5 rounded-lg font-bold flex items-center gap-2"><ExternalLink size={16} /> Export All</button>
                                    <button onClick={generateSEOOutputs} className="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-bold flex items-center gap-2"><Zap size={18} /> Generate Now</button>
                                </div>
                            </div>
                            {!generatedAssets ? (
                                <div className="flex-1 flex flex-col items-center justify-center text-center p-12 border-2 border-dashed border-gray-200 rounded-xl bg-gray-50">
                                    <h3 className="text-lg font-bold text-gray-700 mb-2">Ready to Generate</h3>
                                    <p className="text-gray-500 max-w-md">Click "Generate Now" to compile all data.</p>
                                </div>
                            ) : (
                                <div className="animate-fadeIn space-y-6">
                                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <div className="flex justify-between mb-2"><h3 className="text-sm font-bold text-gray-700">1. Product Title</h3><CopyButton text={generatedAssets.productTitle} /></div>
                                        <div className="p-3 bg-white border rounded text-sm text-gray-800 font-mono break-words">{generatedAssets.productTitle}</div>
                                    </div>
                                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <div className="flex justify-between mb-2"><h3 className="text-sm font-bold text-gray-700">2. Meta Description</h3><CopyButton text={generatedAssets.metaDesc} /></div>
                                        <div className="p-3 bg-white border rounded text-sm text-gray-800 font-mono break-words">{generatedAssets.metaDesc}</div>
                                    </div>
                                    <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <div className="flex justify-between mb-2"><h3 className="text-sm font-bold text-gray-700">3. Product URL</h3><CopyButton text={generatedAssets.productUrl} /></div>
                                        <div className="p-3 bg-white border rounded text-sm text-gray-800 font-mono break-words">{generatedAssets.productUrl}</div>
                                    </div>
                                     <div className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                        <div className="flex justify-between mb-2"><h3 className="text-sm font-bold text-gray-700">4. FAQs JSON</h3><CopyButton text={generatedAssets.faqsJson} /></div>
                                        <textarea className="w-full p-3 bg-white border rounded text-xs font-mono text-gray-600 h-48" readOnly value={generatedAssets.faqsJson}></textarea>
                                    </div>

                                    {/* Session History Visualizer */}
                                    {sessionHistory.length > 0 && (
                                        <div className="mt-8 pt-6 border-t border-gray-200">
                                            <h3 className="text-lg font-bold text-gray-800 mb-4">Session History ({sessionHistory.length} Products)</h3>
                                            <div className="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                                                <table className="w-full text-left text-sm">
                                                    <thead className="bg-gray-100 text-gray-600 uppercase text-xs">
                                                        <tr>
                                                            <th className="p-3">SKU</th>
                                                            <th className="p-3">Product Name</th>
                                                            <th className="p-3">URL Slug</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody className="divide-y divide-gray-200">
                                                        {sessionHistory.map((item, idx) => (
                                                            <tr key={idx} className="hover:bg-white">
                                                                <td className="p-3 font-mono text-xs">{item.sku || '-'}</td>
                                                                <td className="p-3 font-medium text-gray-800">{item.name}</td>
                                                                <td className="p-3 text-blue-600 font-mono text-xs truncate max-w-xs">{item.url}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    );
                    default: return null;
                }
            };

            const steps = [
                { num: 1, label: "Organization", icon: Building },
                { num: 2, label: "Market Strategy", icon: Globe },
                { num: 3, label: "Engineering Specs", icon: Wrench },
                { num: 4, label: "Product Intelligence", icon: Zap },
                { num: 5, label: "Content Engine", icon: PenTool },
                { num: 6, label: "Asset Generation", icon: Code }
            ];

            return (
                <div className="flex h-full flex-col md:flex-row">
                    <div className="w-full md:w-72 bg-gray-900 flex flex-col border-r border-gray-800 shrink-0">
                        <div className="p-6 border-b border-gray-800">
                            <h1 className="text-white font-bold text-xl tracking-tight flex items-center gap-2"><Zap className="text-blue-500" /> Dynamic</h1>
                            <p className="text-gray-500 text-xs mt-1 uppercase tracking-widest">SEO & GEO Architect</p>
                        </div>
                        <div className="p-4 space-y-2 overflow-y-auto flex-1">
                            {steps.map(s => <SidebarStep key={s.num} stepNumber={s.num} label={s.label} icon={s.icon} current={currentStep} onClick={setCurrentStep} />)}
                        </div>
                        <div className="p-4 border-t border-gray-800">
                             <button onClick={resetProject} className="w-full flex items-center justify-center gap-2 text-gray-400 hover:text-white text-xs uppercase tracking-wider py-2 hover:bg-gray-800 rounded transition-colors"><RotateCcw size={14} /> Reset Project</button>
                        </div>
                    </div>
                    <div className="flex-1 flex flex-col overflow-hidden bg-gray-50">
                        <div className="px-6 pt-4 pb-2 bg-white border-b border-gray-100">
                            <div className="flex justify-between items-center mb-2">
                                <span className="text-xs font-bold text-gray-400 uppercase tracking-wider">Progress</span>
                                <span className="text-xs font-bold text-blue-600">{Math.round((currentStep / 6) * 100)}%</span>
                            </div>
                            <ProgressBar step={currentStep} />
                        </div>
                        {renderStepContent()}
                        <div className="p-4 border-t border-gray-200 bg-white flex justify-end">
                            {currentStep < 6 && <button onClick={handleNextStep} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold flex items-center gap-2 transition-colors shadow-sm">Next Step <ArrowRight size={16} /></button>}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
