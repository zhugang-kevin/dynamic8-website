<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal SEO & GEO Architect v5.0 (Enterprise)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.Firebase = { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInAnonymously, signInWithCustomToken, getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot };
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        .step-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .icon-sm { width: 16px; height: 16px; }
        .icon-md { width: 24px; height: 24px; }

        /* Auth Screen Styles */
        .auth-container { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, memo } = React;

        // --- ICONS ---
        const Icons = {
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            Building: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="9" y1="22" x2="9" y2="22.01"></line><line x1="15" y1="22" x2="15" y2="22.01"></line><line x1="12" y1="22" x2="12" y2="22.01"></line><line x1="12" y1="18" x2="12" y2="18.01"></line><line x1="9" y1="18" x2="9" y2="18.01"></line><line x1="15" y1="18" x2="15" y2="18.01"></line><line x1="12" y1="14" x2="12" y2="14.01"></line><line x1="9" y1="14" x2="9" y2="14.01"></line><line x1="15" y1="14" x2="15" y2="14.01"></line><line x1="12" y1="10" x2="12" y2="10.01"></line><line x1="9" y1="10" x2="9" y2="10.01"></line><line x1="15" y1="10" x2="15" y2="10.01"></line><line x1="12" y1="6" x2="12" y2="6.01"></line><line x1="9" y1="6" x2="9" y2="6.01"></line><line x1="15" y1="6" x2="15" y2="6.01"></line></svg>,
            Globe: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Wrench: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
            PenTool: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="M2 2l7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>,
            Code: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-4A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-4A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            ArrowRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
            ChevronDown: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            ExternalLink: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Cpu: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Book: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Link: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Lock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>,
            LogOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
        };

        const { Copy, Check, FileText, Search, Zap, Cpu, MapPin, Users, Activity, Building, Book, ChevronDown, ArrowRight, Globe, Wrench, PenTool, Code, Brain, Link, Trash, Plus, ExternalLink, Lock, LogOut } = Icons;

        // --- CONSTANTS ---
        const INDUSTRY_CONFIG = {
            "Electronics": {
                categories: ["Smartphones", "Laptops", "Cables & Accessories", "Wearables", "Home Audio"],
                specs: [
                    { name: "connectorType", label: "Connector Type", placeholder: "e.g. USB-C" },
                    { name: "powerOutput", label: "Power Output", placeholder: "e.g. 65W" },
                    { name: "batteryLife", label: "Battery Life", placeholder: "e.g. 24 Hours" },
                    { name: "compatibility", label: "Compatibility", placeholder: "e.g. iOS, Android" },
                    { name: "warranty", label: "Warranty", placeholder: "e.g. 1 Year" }
                ],
                personas: ["Tech Enthusiasts", "Gamers", "Professional Creators", "Budget Shoppers"],
                mockKeywords: ["High Performance", "Fast Charging", "Latest Tech", "Durable"]
            },
            "Fashion": {
                categories: ["Men's Apparel", "Women's Apparel", "Footwear", "Accessories", "Jewelry"],
                specs: [
                    { name: "material", label: "Material", placeholder: "e.g. 100% Cotton" },
                    { name: "size", label: "Size Range", placeholder: "e.g. XS - XXL" },
                    { name: "careInstructions", label: "Care Instructions", placeholder: "e.g. Machine Wash Cold" },
                    { name: "fit", label: "Fit Type", placeholder: "e.g. Slim Fit" },
                    { name: "origin", label: "Country of Origin", placeholder: "e.g. Italy" }
                ],
                personas: ["Trendsetters", "Sustainable Shoppers", "Luxury Buyers", "Minimalists"],
                mockKeywords: ["Sustainable Fashion", "Trendy Look", "Premium Quality", "Comfort Fit"]
            },
            "Healthcare": {
                categories: ["Supplements", "Medical Devices", "Personal Care", "Fitness Equipment"],
                specs: [
                    { name: "ingredients", label: "Active Ingredients", placeholder: "e.g. Vitamin C" },
                    { name: "dosage", label: "Dosage", placeholder: "e.g. 1 Tablet Daily" },
                    { name: "certifications", label: "Certifications", placeholder: "e.g. FDA Approved" },
                    { name: "safetyWarnings", label: "Safety Warnings", placeholder: "e.g. Consult physician" },
                    { name: "shelfLife", label: "Shelf Life", placeholder: "e.g. 24 Months" }
                ],
                personas: ["Health Conscious", "Seniors", "Athletes", "Parents"],
                mockKeywords: ["Clinically Proven", "Natural Ingredients", "Doctor Recommended", "Safe & Effective"]
            },
            "Automotive": {
                categories: ["Car Parts", "Accessories", "Car Care", "Electronics"],
                specs: [
                    { name: "compatibility", label: "Vehicle Compatibility", placeholder: "e.g. Toyota Camry 2020+" },
                    { name: "material", label: "Material", placeholder: "e.g. Carbon Fiber" },
                    { name: "dimensions", label: "Dimensions", placeholder: "e.g. 10x5x2 inches" },
                    { name: "installation", label: "Installation Type", placeholder: "e.g. DIY / Professional" },
                    { name: "warranty", label: "Warranty", placeholder: "e.g. 3 Years" }
                ],
                personas: ["DIY Mechanics", "Car Enthusiasts", "Daily Commuters", "Fleet Managers"],
                mockKeywords: ["OEM Quality", "Easy Installation", "Performance Boost", "Durable"]
            },
            "General": { // Fallback
                categories: ["General Products", "Services", "Digital Goods"],
                specs: [
                    { name: "feature1", label: "Key Feature 1", placeholder: "Feature detail" },
                    { name: "feature2", label: "Key Feature 2", placeholder: "Feature detail" },
                    { name: "benefit", label: "Primary Benefit", placeholder: "User benefit" },
                    { name: "usage", label: "Usage", placeholder: "How to use" },
                    { name: "guarantee", label: "Guarantee", placeholder: "Satisfaction guarantee" }
                ],
                personas: ["General Consumers", "B2B Clients", "B2C Customers"],
                mockKeywords: ["Best Value", "Top Rated", "High Quality", "Reliable"]
            }
        };

        const CONTINENTS = {
            "North America": ["United States", "Canada", "Mexico"],
            "Europe": ["United Kingdom", "Germany", "France", "Italy", "Spain"],
            "Asia": ["China", "Japan", "India", "Singapore", "South Korea"],
            "South America": ["Brazil", "Argentina", "Chile"],
            "Oceania": ["Australia", "New Zealand"],
            "Africa": ["South Africa", "Nigeria", "Egypt"]
        };

        const INCOME_GROUPS = ["Low Income", "Middle Income", "High Income", "Affluent"];
        const GENDERS = ["Male", "Female", "Non-binary", "All"];
        const LANGUAGES = ["English", "Spanish", "Mandarin", "French", "German", "Arabic"];

        // --- COMPONENTS (Memoized) ---

        const InputField = memo(({ label, name, value, onChange, placeholder, type = "text", required, icon: Icon, action, id, disabled, ...props }) => {
            const inputId = id || name;
            return (
                <div className="mb-4">
                    <div className="flex justify-between items-center mb-1">
                        <label htmlFor={inputId} className="block text-xs font-bold text-gray-500 uppercase tracking-wider">
                            {label} {required && <span className="text-red-500">*</span>}
                        </label>
                        {action && action}
                    </div>
                    <div className="relative">
                        <input
                            id={inputId}
                            type={type}
                            name={name}
                            value={value || ''} 
                            onChange={onChange}
                            placeholder={placeholder}
                            required={required}
                            disabled={disabled}
                            className={`w-full pl-9 pr-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all hover:border-blue-300 ${disabled ? 'bg-gray-100 text-gray-500 cursor-not-allowed' : ''}`}
                            {...props}
                        />
                        {Icon ? <Icon className="absolute left-3 top-3 text-gray-400 w-4 h-4" /> : <div className="absolute left-3 top-2.5 w-4 h-4" />}
                    </div>
                </div>
            );
        });

        const TextArea = memo(({ label, name, value, onChange, placeholder, action, id }) => {
            const inputId = id || name;
            return (
                <div className="mb-4 col-span-2">
                    <div className="flex justify-between items-center mb-1">
                        <label htmlFor={inputId} className="block text-xs font-bold text-gray-500 uppercase tracking-wider">
                            {label}
                        </label>
                        {action && action}
                    </div>
                    <textarea
                        id={inputId}
                        name={name}
                        value={value || ''} 
                        onChange={onChange}
                        placeholder={placeholder}
                        rows="4"
                        className="w-full p-3 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all hover:border-blue-300"
                    ></textarea>
                </div>
            );
        });

        const CheckboxGroup = memo(({ label, options, selected, onChange }) => (
            <div className="mb-4">
                <label className="block text-xs font-bold text-gray-500 uppercase mb-2 tracking-wider">{label}</label>
                <div className="grid grid-cols-2 gap-2 bg-white border border-gray-200 p-3 rounded-lg max-h-40 overflow-y-auto" role="group" aria-label={label}>
                    {options.map(opt => (
                        <label key={opt} htmlFor={`checkbox-${opt}`} className="flex items-center gap-2 text-sm text-gray-700 cursor-pointer hover:bg-gray-50 p-1 rounded">
                            <input 
                                id={`checkbox-${opt}`}
                                type="checkbox" 
                                checked={selected.includes(opt)}
                                onChange={() => onChange(opt)}
                                className="rounded text-blue-600 focus:ring-blue-500"
                            />
                            {opt}
                        </label>
                    ))}
                </div>
            </div>
        ));

        const CopyButton = memo(({ text }) => {
            const [copied, setCopied] = useState(false);
            const handleCopy = () => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-9999px";
                textArea.style.top = "0";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    alert('Failed to copy to clipboard. Please try again.');
                }
                
                document.body.removeChild(textArea);
            };
            return (
                <button onClick={handleCopy} aria-label="Copy content to clipboard" className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium transition-colors border ${copied ? 'bg-green-50 border-green-200 text-green-700' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'}`}>
                    {copied ? <Check size={14} /> : <Copy size={14} />} {copied ? 'Copied' : 'Copy'}
                </button>
            );
        });

        const SidebarStep = memo(({ stepNumber, label, icon: Icon, current, onClick }) => (
            <button 
                onClick={() => onClick(stepNumber)} 
                aria-current={current === stepNumber ? 'step' : undefined}
                className={`w-full flex items-center gap-3 px-4 py-3.5 rounded-lg cursor-pointer transition-all border-l-4 text-left ${current === stepNumber ? 'bg-blue-900 border-blue-500 text-white shadow-lg' : 'border-transparent text-gray-400 hover:text-white hover:bg-gray-800'}`}
            >
                <div className={`flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${current === stepNumber ? 'bg-blue-500 text-white' : 'bg-gray-700 text-gray-400'}`}>{stepNumber}</div>
                <span className="font-medium text-xs md:text-sm">{label}</span>
            </button>
        ));

        // --- AUTH COMPONENT ---
        const AuthPage = ({ onLogin }) => {
            const [isRegister, setIsRegister] = useState(false);
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [orgName, setOrgName] = useState("");
            const [error, setError] = useState("");
            const [loading, setLoading] = useState(false);

            const handleAuth = async (e) => {
                e.preventDefault();
                setError("");
                setLoading(true);
                const auth = window.Firebase.getAuth();
                const db = window.Firebase.getFirestore();

                try {
                    if (isRegister) {
                        if (!orgName.trim()) throw new Error("Organization Name is required.");
                        const userCredential = await window.Firebase.createUserWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;
                        const orgId = "org_" + user.uid.slice(0, 8); // Simple unique org ID gen

                        // Create Org Doc
                        await window.Firebase.setDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'organizations', orgId), {
                            name: orgName,
                            subscriptionStatus: 'inactive', // Gated
                            createdAt: new Date().toISOString()
                        });

                        // Create User Doc tied to Org
                        await window.Firebase.setDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'users', user.uid), {
                            email: user.email,
                            orgId: orgId,
                            role: 'admin'
                        });
                    } else {
                        await window.Firebase.signInWithEmailAndPassword(auth, email, password);
                    }
                } catch (err) {
                    setError(err.message);
                    setLoading(false);
                }
            };

            return (
                <div className="w-full h-full flex items-center justify-center auth-container p-4">
                    <div className="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
                        <div className="flex justify-center mb-6">
                            <div className="bg-blue-100 p-3 rounded-full"><Zap className="text-blue-600 w-8 h-8" /></div>
                        </div>
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-2">{isRegister ? "Create Account" : "Welcome Back"}</h2>
                        <p className="text-center text-gray-500 text-sm mb-6">{isRegister ? "Start your Enterprise SEO journey" : "Login to access your tools"}</p>
                        
                        {error && <div className="bg-red-50 text-red-600 p-3 rounded text-sm mb-4">{error}</div>}

                        <form onSubmit={handleAuth} className="space-y-4">
                            {isRegister && (
                                <InputField id="orgName" label="Organization Name (Locked)" name="orgName" value={orgName} onChange={(e) => setOrgName(e.target.value)} placeholder="e.g. Acme Corp" required icon={Building} />
                            )}
                            <InputField id="email" label="Email Address" type="email" name="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="name@company.com" required />
                            <InputField id="password" label="Password" type="password" name="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="••••••••" required />
                            
                            <button type="submit" disabled={loading} className="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3 rounded-lg transition-colors disabled:opacity-50">
                                {loading ? "Processing..." : (isRegister ? "Register & Setup Org" : "Login")}
                            </button>
                        </form>
                        
                        <div className="mt-6 text-center text-sm">
                            <button onClick={() => setIsRegister(!isRegister)} className="text-blue-600 hover:underline font-medium">
                                {isRegister ? "Already have an account? Login" : "Need an account? Register"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Paywall = ({ onSubscribe, orgName }) => (
            <div className="w-full h-full flex items-center justify-center bg-gray-100 p-4">
                <div className="bg-white p-8 rounded-2xl shadow-lg w-full max-w-lg text-center">
                    <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <Lock className="text-yellow-600 w-8 h-8" />
                    </div>
                    <h2 className="text-2xl font-bold text-gray-900 mb-2">License Required</h2>
                    <p className="text-gray-600 mb-6">
                        The organization <strong>{orgName}</strong> does not have an active license. Please purchase a subscription to unlock the Architect.
                    </p>
                    <div className="bg-gray-50 p-4 rounded-lg mb-6 text-left border border-gray-200">
                        <h4 className="font-bold text-gray-800 text-sm uppercase mb-2">Enterprise Plan</h4>
                        <ul className="text-sm text-gray-600 space-y-2">
                            <li className="flex items-center gap-2"><Check className="w-4 h-4 text-green-500"/> Unlimited Projects</li>
                            <li className="flex items-center gap-2"><Check className="w-4 h-4 text-green-500"/> GEO & AEO Optimization</li>
                            <li className="flex items-center gap-2"><Check className="w-4 h-4 text-green-500"/> Cloud Save</li>
                        </ul>
                    </div>
                    <button onClick={onSubscribe} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition-colors">
                        Purchase License ($49/mo)
                    </button>
                </div>
            </div>
        );

        // --- MAIN APP ---

        const Dashboard = ({ user, orgData, setOrgData, onLogout, db }) => {
            const [currentStep, setCurrentStep] = useState(1);
            const [saving, setSaving] = useState(false);
            
            // State
            const [industry, setIndustry] = useState('Electronics');
            const [category, setCategory] = useState('Smartphones');
            const [specsData, setSpecsData] = useState({}); 
            const [marketData, setMarketData] = useState({ 
                primaryKeywords: [], 
                hsCode: "", 
                selectedContinent: "North America", 
                selectedCountries: ["United States"], 
                selectedGenders: ["All"], 
                selectedPersonas: [], 
                selectedIncome: ["Middle Income"], 
                selectedLanguages: ["English"], 
                analysis: "", 
                researchPrompt: "" 
            });
            const [productData, setProductData] = useState({ 
                productName: "", 
                description: "", 
                brandName: "", 
                sku: "", 
                price: "", 
                currency: "USD", 
                availability: "InStock", 
                shippingInfo: "", 
                productType: "Physical", 
                productTags: "", 
                additionalInfo: "",
                usp: "" 
            });
            const [contentData, setContentData] = useState({
                faqs: [{question: "Q1?", answer: "A1."}],
                internalLinks: [],
                generated: false
            });

            // Load Saved Data on Mount
            useEffect(() => {
                if (!user.orgId) return;
                const loadData = async () => {
                    try {
                        const docSnap = await window.Firebase.getDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'organizations', user.orgId, 'data', 'main_project'));
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            if (data.industry) setIndustry(data.industry);
                            if (data.category) setCategory(data.category);
                            if (data.specsData) setSpecsData(data.specsData);
                            if (data.marketData) setMarketData(data.marketData);
                            if (data.productData) setProductData(data.productData);
                            if (data.contentData) setContentData(data.contentData);
                            // Use Org Data but preserve locked name
                            if (data.orgData) setOrgData(prev => ({...prev, ...data.orgData, orgName: prev.orgName})); 
                        }
                    } catch (e) { console.error("Load error", e); }
                };
                loadData();
            }, [user.orgId, db]);

            // Auto-Save Logic
            useEffect(() => {
                if (!user.orgId) return;
                const timer = setTimeout(async () => {
                    setSaving(true);
                    await window.Firebase.setDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'organizations', user.orgId, 'data', 'main_project'), {
                        industry, category, specsData, marketData, productData, contentData, orgData
                    }, { merge: true });
                    setSaving(false);
                }, 2000);
                return () => clearTimeout(timer);
            }, [industry, category, specsData, marketData, productData, contentData, orgData, user.orgId, db]);

            // ... (Handlers remain mostly same, updated Org handler) ...
            const handleIndustryChange = (e) => {
                setIndustry(e.target.value);
                setCategory(INDUSTRY_CONFIG[e.target.value].categories[0]);
            };

            const handleOrgChange = useCallback((e) => setOrgData(prev => ({...prev, [e.target.name]: e.target.value})), [setOrgData]);
            const handleSpecsChange = useCallback((e) => setSpecsData(prev => ({...prev, [e.target.name]: e.target.value})), []);
            const handleProductChange = useCallback((e) => setProductData(prev => ({...prev, [e.target.name]: e.target.value})), []);
            
            const toggleSelection = useCallback((list, item) => {
                return list.includes(item) ? list.filter(i => i !== item) : [...list, item];
            }, []);

            const handleNextStep = useCallback(() => {
                if (currentStep === 4) {
                    if (!productData.productTags || (typeof productData.productTags === 'string' && !productData.productTags.trim())) {
                        alert("Product Tags are mandatory.");
                        return;
                    }
                }
                setCurrentStep(prev => prev + 1);
            }, [currentStep, productData.productTags]);

            // Dynamic Generators (Same as v4)
            const autoGenerateKeywords = useCallback(() => {
                const config = INDUSTRY_CONFIG[industry] || INDUSTRY_CONFIG["General"];
                const baseKeywords = config.mockKeywords.map(kw => `${kw} ${category}`);
                setMarketData(prev => ({ ...prev, primaryKeywords: baseKeywords }));
            }, [industry, category]);

            const generateSmartTitle = useCallback(() => {
                const brand = productData.brandName || "Brand";
                const name = productData.productName || category;
                const usp = productData.usp || "High Quality";
                setProductData(prev => ({...prev, productName: `${brand} ${name} - ${usp}`}));
            }, [productData.brandName, productData.productName, productData.usp, category]);

            const generateSmartDescription = useCallback(() => {
                const desc = `Discover the best ${category} from ${productData.brandName || 'us'}. Designed for ${marketData.selectedPersonas.join(', ') || 'everyone'}, offering ${productData.usp || 'great value'}.`;
                setProductData(prev => ({...prev, description: desc}));
            }, [category, productData.brandName, marketData.selectedPersonas, productData.usp]);

            // Link Handlers (Same as v4)
            const addInternalLink = useCallback(() => setContentData(prev => ({...prev, internalLinks: [...prev.internalLinks, {title: "", url: ""}]})), []);
            const updateInternalLink = useCallback((idx, field, val) => {
                setContentData(prev => {
                    const newLinks = [...prev.internalLinks];
                    newLinks[idx] = { ...newLinks[idx], [field]: val };
                    return {...prev, internalLinks: newLinks};
                });
            }, []);
            const removeInternalLink = useCallback((idx) => {
                setContentData(prev => ({...prev, internalLinks: prev.internalLinks.filter((_, i) => i !== idx)}));
            }, []);
            const searchGoogle = useCallback((queryType) => {
                let query = `${productData.productName} ${queryType}`;
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            }, [productData.productName]);
            const generateResearchStrategy = useCallback(() => {
                const strategy = `STRATEGIC RESEARCH ARCHITECT\nTarget: ${marketData.selectedCountries.join(', ')}\nPersona: ${marketData.selectedPersonas.join(', ')}\n\n1. REGULATORY INTELLIGENCE\n2. PERSONA VALIDATION\n3. LOGISTICS\n4. COMPETITION`;
                setMarketData(prev => ({...prev, analysis: strategy}));
            }, [marketData.selectedCountries, marketData.selectedPersonas]);
            const generateDeepPrompt = useCallback(() => {
                const prompt = `Act as a Senior International Market Researcher. Target: ${marketData.selectedCountries.join(', ')}. Product HS Code: ${marketData.hsCode}. Provide market analysis on duties, competition, and channels.`;
                setMarketData(prev => ({...prev, researchPrompt: prompt}));
            }, [marketData.selectedCountries, marketData.hsCode]);

            // Outputs (Same as v4)
            const outputs = useMemo(() => {
                if (currentStep !== 6) return {};
                const slug = productData.productName.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                const faqsJson = contentData.faqs.map(f => ({ question: f.question, answer: f.answer }));
                return {
                    productTitle: productData.productName,
                    blogTitle: `Ultimate Guide to ${category}`,
                    blogUrl: `/blog/guide-to-${slug}`,
                    faqsJson: JSON.stringify(faqsJson, null, 2),
                    metaDesc: `<title>${productData.productName}</title>\n<meta name="description" content="${productData.description}">`,
                    productUrl: `/products/${slug}`
                };
            }, [currentStep, productData, contentData.faqs, category]);

            const renderStepContent = () => {
                const currentConfig = INDUSTRY_CONFIG[industry] || INDUSTRY_CONFIG["General"];
                switch(currentStep) {
                    case 1: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Building className="text-blue-600"/> Organization & Industry</h2>
                            <div className="bg-blue-50 p-6 rounded-xl border border-blue-200 shadow-sm mb-6">
                                <h3 className="text-sm font-bold text-blue-900 uppercase border-b border-blue-200 pb-2 mb-4">1. Industry Setup</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Industry</label>
                                        <select className="w-full p-2 border rounded" value={industry} onChange={handleIndustryChange}>
                                            {Object.keys(INDUSTRY_CONFIG).map(ind => <option key={ind} value={ind}>{ind}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Product Category</label>
                                        <select className="w-full p-2 border rounded" value={category} onChange={(e) => setCategory(e.target.value)}>
                                            {currentConfig.categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4">
                                <h3 className="text-sm font-bold text-gray-900 uppercase border-b pb-2">2. Organization Details</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    {/* LOCKED ORG NAME */}
                                    <InputField id="orgName" label="Organization Name (Locked)" name="orgName" value={orgData.orgName} onChange={()=>{}} disabled={true} icon={Lock} />
                                    <InputField id="orgUrl" label="Website URL" name="orgUrl" value={orgData.orgUrl} onChange={handleOrgChange} placeholder="https://..." />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    <InputField id="orgLogoUrl" label="Logo URL" name="orgLogoUrl" value={orgData.orgLogoUrl} onChange={handleOrgChange} />
                                    <InputField id="orgPhone" label="Phone" name="orgPhone" value={orgData.orgPhone} onChange={handleOrgChange} />
                                </div>
                            </div>
                        </div>
                    );
                    case 2: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Globe className="text-blue-600"/> Global Market Strategy</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-6">
                                <div className="grid grid-cols-2 gap-6">
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Target Continent</label>
                                        <select className="w-full p-2 border rounded mb-2" value={marketData.selectedContinent} onChange={(e) => setMarketData(prev => ({...prev, selectedContinent: e.target.value, selectedCountries: []}))}>
                                            {Object.keys(CONTINENTS).map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                        <CheckboxGroup label="Target Countries" options={CONTINENTS[marketData.selectedContinent]} selected={marketData.selectedCountries} onChange={(item) => setMarketData(prev => ({...prev, selectedCountries: toggleSelection(prev.selectedCountries, item)}))} />
                                    </div>
                                    <div>
                                        <CheckboxGroup label={`Target Personas (${industry})`} options={currentConfig.personas} selected={marketData.selectedPersonas} onChange={(item) => setMarketData(prev => ({...prev, selectedPersonas: toggleSelection(prev.selectedPersonas, item)}))} />
                                        <div className="mt-4">
                                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Target Keywords</label>
                                            <div className="flex gap-2 mb-2">
                                                <button onClick={autoGenerateKeywords} className="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded font-bold">Auto-Generate for {industry}</button>
                                            </div>
                                            <textarea className="w-full p-2 border rounded text-sm" rows="3" value={marketData.primaryKeywords.join(', ')} readOnly placeholder="Keywords will appear here..." />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    );
                    case 3: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Wrench className="text-blue-600"/> Product Specifications ({industry})</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                                <div className="grid grid-cols-2 gap-4">
                                    {currentConfig.specs.map((spec) => (
                                        <InputField key={spec.name} id={spec.name} label={spec.label} name={spec.name} value={specsData[spec.name]} onChange={handleSpecsChange} placeholder={spec.placeholder} />
                                    ))}
                                </div>
                            </div>
                        </div>
                    );
                    case 4: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><Zap className="text-blue-600"/> Product Intelligence</h2>
                            <div className="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <InputField id="brandName" label="Brand Name" name="brandName" value={productData.brandName} onChange={handleProductChange} />
                                    <InputField id="sku" label="SKU" name="sku" value={productData.sku} onChange={handleProductChange} />
                                </div>
                                <InputField id="productName" label="Product Name" name="productName" value={productData.productName} onChange={handleProductChange} icon={Zap} action={<button onClick={generateSmartTitle} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">Auto-Generate</button>} />
                                <TextArea id="usp" label="Unique Selling Point (USP)" name="usp" value={productData.usp} onChange={handleProductChange} placeholder="e.g. 100% Organic, Lifetime Warranty" />
                                <TextArea id="description" label="Description" name="description" value={productData.description} onChange={handleProductChange} action={<button onClick={generateSmartDescription} className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">Auto-Generate</button>} />
                                <InputField id="productTags" label="Tags (Required)" name="productTags" value={productData.productTags} onChange={handleProductChange} required={true} />
                            </div>
                        </div>
                    );
                    case 5: return (
                        <div className="p-6 overflow-y-auto h-full step-content">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><PenTool className="text-blue-600"/> Content Engine</h2>
                            <div className="bg-white p-6 rounded-xl border shadow-sm">
                                <h3 className="font-bold mb-4">Internal Links</h3>
                                {contentData.internalLinks.map((link, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input className="border p-2 rounded flex-1" placeholder="Title" value={link.title} onChange={(e)=>updateInternalLink(i,'title',e.target.value)} />
                                        <input className="border p-2 rounded flex-1" placeholder="URL" value={link.url} onChange={(e)=>updateInternalLink(i,'url',e.target.value)} />
                                        <button onClick={()=>removeInternalLink(i)} className="text-red-500"><Trash size={16}/></button>
                                    </div>
                                ))}
                                <button onClick={addInternalLink} className="text-blue-600 font-bold text-sm flex items-center gap-1"><Plus size={14}/> Add Link</button>
                            </div>
                        </div>
                    );
                    case 6: return (
                        <div className="p-6 bg-white h-full overflow-y-auto">
                            <h2 className="text-2xl font-bold mb-6 flex items-center gap-2"><Code className="text-blue-600"/> Final Assets</h2>
                            <div className="space-y-6">
                                <div className="bg-gray-50 p-4 rounded border">
                                    <div className="flex justify-between mb-2"><h3 className="font-bold">1. Product Title</h3><CopyButton text={outputs.productTitle}/></div>
                                    <div className="font-mono text-sm p-2 bg-white border rounded">{outputs.productTitle}</div>
                                </div>
                                <div className="bg-gray-50 p-4 rounded border">
                                    <div className="flex justify-between mb-2"><h3 className="font-bold">4. Custom FAQs</h3><CopyButton text={outputs.faqsJson}/></div>
                                    <textarea className="w-full h-32 font-mono text-xs p-2 border rounded" readOnly value={outputs.faqsJson}/>
                                </div>
                                <div className="bg-gray-50 p-4 rounded border">
                                    <div className="flex justify-between mb-2"><h3 className="font-bold">5. Complete Meta Tags</h3><CopyButton text={outputs.metaDesc}/></div>
                                    <textarea className="w-full p-3 bg-white border rounded text-xs font-mono text-gray-600 h-32" readOnly value={outputs.metaDesc}></textarea>
                                </div>
                            </div>
                        </div>
                    );
                    default: return null;
                }
            };

            const steps = [
                { num: 1, label: "Org & Industry", icon: Building },
                { num: 2, label: "Market Strategy", icon: Globe },
                { num: 3, label: "Specifications", icon: Wrench },
                { num: 4, label: "Product Info", icon: Zap },
                { num: 5, label: "Content", icon: PenTool },
                { num: 6, label: "Output", icon: Code }
            ];

            return (
                <div className="flex h-full flex-col md:flex-row">
                    <div className="w-full md:w-64 bg-gray-900 flex flex-col border-r border-gray-800 shrink-0">
                        <div className="p-6 border-b border-gray-800">
                            <h1 className="text-white font-bold text-xl tracking-tight flex items-center gap-2"><Zap className="text-blue-500" /> Universal</h1>
                            <p className="text-gray-500 text-xs mt-1 uppercase tracking-widest">SEO & GEO Architect</p>
                            {saving && <span className="text-xs text-green-400 block mt-2">Saving to Cloud...</span>}
                        </div>
                        <div className="p-4 space-y-2 overflow-y-auto flex-1">
                            {steps.map(s => <SidebarStep key={s.num} stepNumber={s.num} label={s.label} icon={s.icon} current={currentStep} onClick={setCurrentStep} />)}
                        </div>
                        <div className="p-4 border-t border-gray-800">
                            <div className="text-gray-400 text-xs mb-2 truncate">Org: {orgData.orgName}</div>
                            <button onClick={onLogout} className="flex items-center gap-2 text-gray-400 hover:text-white text-sm w-full"><LogOut size={16} /> Logout</button>
                        </div>
                    </div>
                    <div className="flex-1 flex flex-col overflow-hidden bg-gray-50">
                        {renderStepContent()}
                        <div className="p-4 border-t border-gray-200 bg-white flex justify-end">
                            {currentStep < 6 && <button onClick={handleNextStep} className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold flex items-center gap-2 transition-colors shadow-sm">Next Step <ArrowRight size={16} /></button>}
                        </div>
                    </div>
                </div>
            );
        };

        const Root = () => {
            const [user, setUser] = useState(null);
            const [org, setOrg] = useState(null);
            const [orgData, setOrgData] = useState({ orgName: "", orgUrl: "", orgLogoUrl: "", orgPhone: "", orgEmail: "", orgAreaServed: "Global", orgLanguage: "English", orgSameAs: "" });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const firebaseConfig = JSON.parse(window.__firebase_config || '{}');
                const app = window.Firebase.initializeApp(firebaseConfig);
                const auth = window.Firebase.getAuth(app);
                const db = window.Firebase.getFirestore(app);

                const unsubscribe = window.Firebase.onAuthStateChanged(auth, async (u) => {
                    if (u) {
                        // Fetch User Details to get Org ID
                        const userSnap = await window.Firebase.getDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'users', u.uid));
                        if (userSnap.exists()) {
                            const userData = userSnap.data();
                            // Fetch Org Details to get Subscription Status & Name
                            const orgSnap = await window.Firebase.getDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'organizations', userData.orgId));
                            if (orgSnap.exists()) {
                                const od = orgSnap.data();
                                setOrg(od);
                                setOrgData(prev => ({...prev, orgName: od.name})); // Lock Org Name
                                setUser({ ...u, ...userData });
                            }
                        }
                    } else {
                        setUser(null);
                        setOrg(null);
                    }
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const handleLogout = async () => {
                const auth = window.Firebase.getAuth();
                await window.Firebase.signOut(auth);
            };

            const handleSubscribe = async () => {
                if (!user || !user.orgId) return;
                const db = window.Firebase.getFirestore();
                // Simulate purchase by updating DB directly
                await window.Firebase.updateDoc(window.Firebase.doc(db, 'artifacts', window.__app_id || 'default', 'organizations', user.orgId), {
                    subscriptionStatus: 'active'
                });
                setOrg(prev => ({...prev, subscriptionStatus: 'active'}));
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-gray-500">Loading Architect...</div>;

            if (!user) return <AuthPage />;

            if (org && org.subscriptionStatus !== 'active') return <Paywall onSubscribe={handleSubscribe} orgName={org.name} />;

            return <Dashboard user={user} orgData={orgData} setOrgData={setOrgData} onLogout={handleLogout} db={window.Firebase.getFirestore()} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Root />);
    </script>
</body>
</html>
